<style>
	.desktop .vehicle-select__controls:not(.update){
		display: none;
	}
	#updatedFiltersDrawer{
		max-height: 0;
	}
	#updatedFiltersDrawer.filters-drawer--open{
		max-height: 500px;
    overflow: visible;
	}
	@media(max-width: 640px){
		#updatedFiltersDrawer.filters-drawer--open{
			max-height: 700px;
		}
	}
	.filters-drawer__count__btn-reset.hide{
		display: none;
	}
	.vehicle-list.filtered .vehicle{
		display: none;
	}
	.vehicle-list.filtered .vehicle[data-filter-applied="true"]{
		display: block;
	}
	.vehicle-list > div[data-filter-applied="true"]{
    border-top: 0.125rem solid rgba(35,31,32,.2);
	}
	.vehicle-list > div[data-filter-applied="true"] ~ div{
    border-top: 0;
	}
	button[aria-controls="filtersDrawer"]:before{
		content: '';
		background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='17' height='16' viewBox='0 0 17 16' fill='none'%3E%3Cpath fill-rule='evenodd' clip-rule='evenodd' d='M3.40967 8.18815C4.41633 8.47738 5.15301 9.40514 5.15301 10.5047C5.15301 11.6039 4.41626 12.5314 3.40967 12.8206L3.40967 15.667L2.07633 15.667L2.07633 12.8206C1.06975 12.5314 0.333008 11.6039 0.333008 10.5047C0.333008 9.40515 1.06968 8.47739 2.07633 8.18815L2.07633 2.74342L3.40967 2.74342L3.40967 8.18815ZM2.74301 9.42806C2.14853 9.42806 1.66634 9.91025 1.66634 10.5047C1.66634 11.0986 2.14859 11.5807 2.74301 11.5807C3.33742 11.5807 3.81967 11.0986 3.81967 10.5047C3.81967 9.91025 3.33748 9.42806 2.74301 9.42806ZM14.5903 15.667L14.5903 11.0219C15.597 10.7328 16.3337 9.80545 16.3337 8.7059C16.3337 7.60631 15.597 6.67856 14.5903 6.38932L14.5903 2.74306L13.257 2.74306L13.257 6.38932C12.2503 6.67856 11.5137 7.60631 11.5137 8.7059C11.5137 9.80545 12.2503 10.7328 13.257 11.0219L13.257 15.667L14.5903 15.667ZM8.99951 15.667L7.66618 15.667L7.66618 5.05957C6.65959 4.77036 5.92285 3.84279 5.92285 2.74366C5.92285 1.4128 7.00199 0.333661 8.33285 0.333661C9.66371 0.333661 10.7429 1.4128 10.7429 2.74366C10.7429 3.8428 10.0061 4.77037 8.99951 5.05957L8.99951 15.667ZM12.847 8.7059C12.847 8.11142 13.3292 7.62923 13.9237 7.62923C14.5181 7.62923 15.0003 8.11142 15.0003 8.7059C15.0003 9.30017 14.5184 9.7819 13.9237 9.7819C13.329 9.7819 12.847 9.30017 12.847 8.7059ZM8.33285 1.66699C7.73837 1.66699 7.25618 2.14918 7.25618 2.74366C7.25618 3.33753 7.73844 3.81966 8.33285 3.81966C8.92726 3.81966 9.40952 3.33753 9.40952 2.74366C9.40952 2.14918 8.92733 1.66699 8.33285 1.66699Z' fill='%23396451'/%3E%3C/svg%3E");
		height: 16px;
    width: 16px;
    display: inline-block;
    margin-right: 0.5rem;
		position: relative;
    top: 3px;
	}
	button[aria-controls="filtersDrawer"]:focus, button[aria-controls="filtersDrawer"]:hover{
		filter: brightness(0);
	}
	/* v2 styles */
	.filters-drawer__count{
		margin-bottom: .625rem;
	}
	.filters-drawer__results{
		font-weight: 500;
    margin: 0 30px;
	}
	.filters-drawer__count .filter-button{
		border-radius: 50px;
		padding: 8px 14px;
		border: 1px solid #00703C;
		transition: all 200ms cubic-bezier(0.445, 0.05, 0.55, 0.95);
		padding: 5px 16px;
		text-decoration: none;
		border: 1px solid #00703C;
		background-color: transparent;
		color: #00703C;
		text-transform: uppercase;
		font-size: .75rem;
    font-weight: 800;
		letter-spacing: 0.05rem;
    line-height: 1.5;
	}
	.filters-drawer__count .filter-button.active,
	.filters-drawer__count .filter-button.open{
		background-color: #00703C;
		color: #fff;
	}
	.filters-drawer__count .filter-button .count{
		display: none;
	}
	.filters-drawer__count .filter-button.active .count{
		display: inline-block;
	}
	.filters-drawer__count .filter-button .count{
		background: #fff;
    border-radius: 50%;
    color: #00703c;
    font-weight: bold;
		padding: 0px 5px;
    margin-left: 3px;
	}
	.filters-drawer__count__btn-reset-text{
		color: #00703c;
		text-transform: uppercase;
		text-decoration: underline;
		font-weight: bold;
    font-size: 12px;
    line-height: 24px;
	}
	#updatedFiltersDrawer:not(.filters-drawer--open){
		opacity: 0.05;
	}
	#updatedFiltersDrawer[data-category="vehicle"] .mileage-category,
	#updatedFiltersDrawer[data-category="vehicle"] .seats-category{
		display: none;
	}
	#updatedFiltersDrawer[data-category="mileage"] .vehicle-category,
	#updatedFiltersDrawer[data-category="mileage"] .seats-category{
		display: none;
	}
	#updatedFiltersDrawer[data-category="seats"] .vehicle-category,
	#updatedFiltersDrawer[data-category="seats"] .mileage-category{
		display: none;
	}
</style>
<script>
(function() {
	'use strict';
	var isoTest = {
		account : 'EHI',
		portfolio : 'National',
		test : 'MVT-470',
		creative : 'Challenger 1',
		selector : '.vehicle-list > .vehicle',
		lastCategory : 'vehicle',
		allCarsObj : {},
		filtersApplied : {},
		filtersAppliedCount : 0,
		filtersAppliedCategoryCount : {
			vehicle : 0,
			mileage : 0,
			seats : 0
		},
		getReactComponent : function(node){
			for(var key in node) {
				if(key.startsWith('__reactInternalInstance$') ) {
					return node[key];
				}
			}
			return null;
		},
		observeEl : function(selector, callback) {
			var processed = new Map();

			var processElement = function processElement(el) {
				if (processed && !processed.has(el)) {
					processed.set(el, true);
					callback(el);
				}
			};

			var lookForSelector = function lookForSelector() {
				var el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document;

				if (el.matches && el.matches(selector)) {
					if (processElement(el)) return true;
				}

				if (el.querySelectorAll) {
					var elements = el.querySelectorAll(selector);

					if (elements.length) {
						for (var i = 0; i < elements.length; i++) {
							var _el = elements[i];
							if (processElement(_el)) return true;
						}
					}
				}
			};
			lookForSelector();

			var obs = new MutationObserver(function (mutationsList) {
				mutationsList.forEach(function (record) {
					if (record && record.addedNodes && record.addedNodes.length) {
						for (var i = 0; i < record.addedNodes.length; i++) {
							var el = record.addedNodes[i].parentElement;
							if (el && lookForSelector(el)) return true;
						}
					}
				});
			});
			obs.observe(document, {
				attributes: false,
				childList: true,
				subtree: true
			});
		},
		updateCarsObject : function(){
			isoTest.observeEl('.vehicle-list', function(vehicleList){
				
				// Reset filter object on a new list
				isoTest.filtersApplied = {};
				isoTest.filtersAppliedCount = 0;
				isoTest.filtersAppliedCategoryCount = {
					vehicle : 0,
					mileage : 0,
					seats : 0
				};

				// List of all vehicles
				var allCars = isoTest.getReactComponent(vehicleList).return.memoizedProps.vehicles.all;

				// Loop through the allCars array and assign the "code" as the object key
				allCars.forEach(function(car) {
					isoTest.allCarsObj[car.code] = car;
				});

				// Add the filter container alongside the vehicle list
				isoTest.addFilterContainer(vehicleList);

				setTimeout(function(){
					isoTest.updateFilterContainer();
				}, 0);
			});
		},
		observeEachCar : function(){
			// We'll want to make sure we've gotten the data we need before we start
			isoTest.observeEl('.vehicle-list > .vehicle', function(vehicleEl){
				var vehicleReact = isoTest.getReactComponent(vehicleEl);
				var sippCode = vehicleReact.return.memoizedProps.vehicleCode;
				var vehicleInfo = isoTest.allCarsObj[sippCode];

				vehicleEl.setAttribute('data-capacity', vehicleInfo.people_capacity);
				vehicleEl.setAttribute('data-category', vehicleInfo.category.name);
				vehicleEl.setAttribute('data-sipp', vehicleInfo.code);
				vehicleEl.setAttribute('data-unlimited', vehicleInfo.mileage_info.unlimited_mileage);
			});
		},
		updateVehicleResults : function(filtersShown){
			var inputs = document.querySelectorAll('#updatedFiltersDrawer input:checked');
			var filterContainer = document.querySelector('.vehicle-select__controls.update');
			var filterResults = filterContainer.querySelector('.filters-drawer__results');
			var allVehicles = document.querySelectorAll('.vehicle-list .vehicle');

			// Remove the filtered attribute we added to the vehicles
			allVehicles.forEach(function(vehicle){
				vehicle.removeAttribute('data-filtered');
			});

			// Get the filters that are currently applied
			var filters = [];
			var categories = {};
			for(var i = 0; i < inputs.length; i++){
				var input = inputs[i];
				var name = input.getAttribute('data-name');
				var category = input.getAttribute('data-category');

				filters.push(...filtersShown[category][name]);

				// Add all of the related filtersShown names into the categories object
				categories[category] = categories[category] || [];
				categories[category].push(...filtersShown[category][name]);
			}

			// If there are more than one filter applied, we'll need to show the "and"
			var matchedVehicles = [];
			for(var category in categories){
				if(matchedVehicles.length === 0){
					matchedVehicles = categories[category];
				} else {
					matchedVehicles = matchedVehicles.filter(function(vehicle){
						if(categories[category].indexOf(vehicle) > -1){
							return true;
						}
					});
				}
			}
			
			// For the list of vehicles in the filters vehicle list, set the "data-filtered" attribute to true
			for(var i = 0; i < matchedVehicles.length; i++){
				var vehicle = matchedVehicles[i];
				vehicle.setAttribute('data-filtered', true);
			}

			// Update the number of filter results
			var filteredVehicles = document.querySelectorAll('.vehicle-list .vehicle[data-filtered="true"]');
			var clearResults = document.querySelector('.filters-drawer__count__btn-reset');
			var clearBtn = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons .btn--underline');
			var applyBtn = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons [type="submit"]');

			if(filteredVehicles.length > 0 || inputs.length > 0){
				filterResults.innerHTML = filteredVehicles.length + ' Results';
				clearResults.classList.remove('hide');
				clearBtn.disabled = false;
				// applyBtn.disabled = false;
			} else {
				filterResults.innerHTML = allVehicles.length + ' Results';
				clearResults.classList.add('hide');

				if(!document.querySelector('.vehicle-list.filtered')){
					clearBtn.disabled = true;
					// applyBtn.disabled = true;
				}
			}
		},
		updateApplyButton : function(){
			// For each item in the filtersApplied object, check to see if it's still checked
			var change = false;
			for(var inputId in isoTest.filtersApplied){
				var filterApplied = isoTest.filtersApplied[inputId];
				if(filterApplied && (filterApplied.applied === false || filterApplied.changed === true)){
					// console.log('A change has been made to the filter', inputId);
					change = true;
				}
			}

			var checkedInputs = document.querySelectorAll('#updatedFiltersDrawer input:checked');
			var applyButton = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons [type="submit"]');
			if(change || checkedInputs.length > 0){
				// console.log('Apply button should be active');
				applyButton.removeAttribute('disabled');
			}else{
				// console.log('Apply button should be disabled');
				applyButton.setAttribute('disabled', true);
			}
		},
		resetAppliedFilters : function(){

			// Uncheck filters that were not applied
			var checkedInputs = document.querySelectorAll('#updatedFiltersDrawer input:checked');
			checkedInputs.forEach(function(input){
				if(isoTest.filtersApplied[input.id] && isoTest.filtersApplied[input.id].changed === true){
					// console.log('Removing filter: ' + input.id);
					input.click();
				}
			});
			
			// Re-check filters that were changed but not applied
			for(var inputId in isoTest.filtersApplied){
				var input = document.getElementById(inputId);
				if(input){
					if(!input.checked && isoTest.filtersApplied[input.id].applied !== undefined){
						// console.log('Adding filter: ' + input.id);
						input.click();
					}
				}
			}

			// v2 reset category filters
			var activeButton = document.querySelector('.vehicle-select__controls.update .filter-button.open');
			var drawerClosed = document.querySelector('.vehicle-select__controls.update .drawer-animation--open');
			var filterDrawer = document.querySelector('.vehicle-select__controls.update  #updatedFiltersDrawer');

			if(activeButton && !drawerClosed){
				filterDrawer.setAttribute('data-category', '');
				activeButton.classList.remove('open');
			}
		},
		clearFilters : function(clearAndApplyFilters){
			var checkedInputs = document.querySelectorAll('#updatedFiltersDrawer input:checked');
			for(var i = 0; i < checkedInputs.length; i++){
				checkedInputs[i].click();
			}
			if(clearAndApplyFilters){

				// Reset the filters applied object
				isoTest.filtersApplied = {};
				// On clear, make sure the apply button is disabled
				isoTest.updateApplyButton();
				
				var filtersButton = document.querySelector('.drawer-animation--open .js-filters-button');
				if(filtersButton){
					filtersButton.click();
				}

				// Remove the filters from the vehicle list
				var allFilteredVehicles = document.querySelectorAll('.vehicle-list .vehicle[data-filter-applied="true"]');
				allFilteredVehicles.forEach(function(vehicle){
					vehicle.removeAttribute('data-filter-applied');
				});

				var filterList = document.querySelector('.vehicle-list');
				filterList.classList.remove('filtered');
			}
		},
		applyFilters : function(){
			// Check to make sure filters are actually applied
			var checkedInputs = document.querySelectorAll('#updatedFiltersDrawer input:checked');
	
			var filterList = document.querySelector('.vehicle-list');

			// Rest the filters applied object
			isoTest.filtersApplied = {};
			isoTest.updateApplyButton();

			if(checkedInputs.length > 0){

				// Pull the ids from all the checked inputs
				checkedInputs.forEach(function(input){
					isoTest.filtersApplied[input.id] = {
						applied: true
					}
				});

				// Add "filtered" class to hide vehicles that don't match
				filterList.classList.add('filtered');

				// Reset the existing filter results
				var currentlyFilteredVehicles = document.querySelectorAll('.vehicle-list .vehicle[data-filter-applied="true"]');
				currentlyFilteredVehicles.forEach(function(vehicle){
					vehicle.removeAttribute('data-filter-applied');
				});

				// Apply filtered attribute to set of filtered vehicles
				var allFilteredVehicles = document.querySelectorAll('.vehicle-list .vehicle[data-filtered="true"]');
				allFilteredVehicles.forEach(function(vehicle){
					vehicle.setAttribute('data-filter-applied', true);
				});
				
				isoTest.fireTag(filterList, 'Filters Applied');

				var applyBtn = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons [type="submit"]');
				var filterDrawer = document.querySelector('#updatedFiltersDrawer');
				var category = filterDrawer.getAttribute('data-category');
				if(category){
					isoTest.fireTag(applyBtn, 'RW:CarClass:Filter:' + category + '_quick_filter:filter_applied');
				}
			}else{
				var clearBtn = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons .btn--underline');
				var applyBtn = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons [type="submit"]');
				filterList.classList.remove('filtered');

				clearBtn.disabled = true;
				applyBtn.disabled = true;
			}

			// Collapse filter container
			var filtersButton = document.querySelector('.js-filters-button');
			filtersButton.click();
		},
		updateFilterCount : function(e){
			var filterContainer = document.querySelector('.vehicle-select__controls.update');
			var filtersButton = filterContainer.querySelector('.js-filters-button span');
			var name = e.target.getAttribute('data-name');
			var category = e.target.getAttribute('data-category');
			var filterIsChecked = e.target.checked;

			// Update the filter count
			if(filterIsChecked){
				isoTest.filtersAppliedCount++;
				isoTest.filtersAppliedCategoryCount[category]++;
				isoTest.fireTag(e.target, 'RW:CarClass:Filter:' + category + '_select_' + name + ':checked');
			} else {
				isoTest.filtersAppliedCount--;
				isoTest.filtersAppliedCategoryCount[category]--;
				isoTest.fireTag(e.target, 'RW:CarClass:Filter:' + category + '_select_' + name + ':unchecked');
			}

			// Update our results
			if(isoTest.filtersAppliedCount > 0){
				filtersButton.innerHTML = ' (' + isoTest.filtersAppliedCount + ')';
			} else {
				filtersButton.innerHTML = '';
			}

			// For each isoTest.filtersAppliedCategoryCount category, update the count
			for(var category in isoTest.filtersAppliedCategoryCount){
				if(isoTest.filtersAppliedCategoryCount[category] > 0){
					var categoryCount = filterContainer.querySelector('[data-category="' + category + '"] span');
					categoryCount.parentElement.classList.add('active');
					categoryCount.innerHTML = isoTest.filtersAppliedCategoryCount[category];
				} else {
					var categoryCount = filterContainer.querySelector('[data-category="' + category + '"] span');
					categoryCount.parentElement.classList.remove('active');
					categoryCount.innerHTML = '';
				}
			}
		},
		addFilterEvents : function(filtersShown){
			var inputs = document.querySelectorAll('#updatedFiltersDrawer input');

			for(var i = 0; i < inputs.length; i++){
				var input = inputs[i];

				input.addEventListener('change', function(e){
					var filterIsChecked = e.target.checked;

					// Set a true or false value for existing filtersApplied object items depending on the filterIsChecked value
					var filterApplied = isoTest.filtersApplied[e.target.id];
					if(filterApplied && filterApplied.applied !== undefined){
						// Existing filter - if it's unchecked we want this value to be false
						isoTest.filtersApplied[e.target.id].applied = filterIsChecked;
					}else{
						// New filter - if it's checked we want this value to be true
						isoTest.filtersApplied[e.target.id] = {
							changed: filterIsChecked
						}
					}

					// Check filters here if we want to disable the submit button if there are no filter changes
					isoTest.updateApplyButton();

					// Update the number of filters applied
					isoTest.updateFilterCount(e);

					// Update the filtered vehicles
					isoTest.updateVehicleResults(filtersShown);
				});
			}

			// Run initially to update the filter count
			isoTest.updateVehicleResults(false);

			// Clear button events
			var clearResults = document.querySelector('.filters-drawer__count__btn-reset');
			clearResults.addEventListener('click', () => {
				isoTest.clearFilters(true);
			});
			var clearLink = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons .btn--underline');
			clearLink.addEventListener('click', () => {
				isoTest.clearFilters(false);
			});

			var applyBtn = document.querySelector('#updatedFiltersDrawer .cancel-and-apply-buttons [type="submit"]');
			applyBtn.addEventListener('click', (e) => {
				e.preventDefault();
				
				isoTest.applyFilters();
			});
		},
		addFilterCategories : function(filtersShown, filterDrawer){

			var allFiltersHTML = '';

			// Loop through the filtersShown category, seats, and mileage objects and add in the filter category if there's more than one filter
			var filterCategories = Object.keys(filtersShown);
		
			for (var i = 0; i < filterCategories.length; i++) {
				var category = filterCategories[i];
				var filters = filtersShown[category];

				allFiltersHTML += `
					<fieldset class="` + category + `-category">
						<legend class="section-title">` + category + ` Category</legend>
						<div class="filters-drawer__checkboxes">
				`;

				// console.log(filters);
				var filterCheckboxes = Object.keys(filters);
				for (var j = 0; j < filterCheckboxes.length; j++) {
					var filter = filterCheckboxes[j];

					// Only add in the filter if there's a car that matches it
					if(filters[filter].length > 0){
						allFiltersHTML += `
								<div class="input-option-container-wrapper">
									<div class="input-option-container">
										<input id="vehicle_select_` + category + `_` + filter + `" type="checkbox" name="` + category + `" data-name="` + filter + `" data-category="` + category + `" /><label for="vehicle_select_` + category + `_` + filter + `">` + filter + `</label>
									</div>
								</div>
						`;
					}
				}

				allFiltersHTML += `
						</div>
					</fieldset>
				`;
			}

			filterDrawer.innerHTML = allFiltersHTML;
			isoTest.addFilterEvents(filtersShown);
		},
		updateFilterContainer : function(){
			var filterContainer = document.querySelector('.vehicle-select__controls.update');
			var filterDrawer = filterContainer.querySelector('.filters-drawer__form .clearfix');
			var filterResults = filterContainer.querySelector('.filters-drawer__results');

			var allCars = document.querySelectorAll('.vehicle-list > .vehicle');
			var filtersShown = {
				vehicle: {
					'Cars': [],
					'Trucks': [],
					'SUVs': [],
					'Vans': [],
				},
				mileage: {
					'Unlimited Mileage': [],
					'Limited Mileage': [],
				},
				seats: {
					'2+': [],
					'4+': [],
					'5+': [],
					'7+': [],
				}
			};

			// Loop through cars and update our filters list
			allCars.forEach(function(car){
				var category = car.getAttribute('data-category');
				var seats = car.getAttribute('data-capacity');
				var mileage = car.getAttribute('data-unlimited');

				if(filtersShown.vehicle[category]){
					filtersShown.vehicle[category].push(car);
				}

				if(seats > 2){
					filtersShown.seats['2+'].push(car);
				}
				if(seats > 3){
					filtersShown.seats['4+'].push(car);
				}
				if(seats > 4){
					filtersShown.seats['5+'].push(car);
				}
				if(seats > 6){
					filtersShown.seats['7+'].push(car);
				}

				if(mileage === 'true'){
					filtersShown.mileage['Unlimited Mileage'].push(car);
				}else{
					filtersShown.mileage['Limited Mileage'].push(car);
				}
			});

			filterResults.innerHTML = allCars.length + ' Results';

			isoTest.addFilterCategories(filtersShown, filterDrawer);
		},
		filterDrawerClick : function(isRealFilterDrawerClick){
			var filterContainer = document.querySelector('.vehicle-select__controls.update');
			var filterDrawer = document.querySelector('#updatedFiltersDrawer');
			var filterButton = filterContainer.querySelector('.filters-drawer__count button.btn-link');
			
			filterDrawer.classList.toggle('filters-drawer--open');
			filterContainer.querySelector('.filters-drawer').classList.toggle('drawer-animation--open');
			filterContainer.parentElement.parentElement.classList.toggle('vehicle-select--filters-active');

			if(filterDrawer.classList.contains('filters-drawer--open')){
				var lastClickedCategory = document.querySelector('.js-toggle-' + isoTest.lastCategory);
				if(lastClickedCategory && !lastClickedCategory.classList.contains('open')){
					isoTest.quickFilterClick(lastClickedCategory, false);
				}

				if(isRealFilterDrawerClick){
					isoTest.fireTag(filterButton, 'Filters Opened');
				}
			}

			isoTest.resetAppliedFilters();
		},
		quickFilterClick : function(button, isRealClick){
			// Check the existing state of the drawer
			var filterContainer = document.querySelector('.vehicle-select__controls.update');
			var filterDrawer = document.querySelector('#updatedFiltersDrawer');
			var filterDrawerOpen = filterDrawer.classList.contains('filters-drawer--open');

			// Check the existing state of the button
			var buttonOpen = button.classList.contains('open');
			
			// Make sure another button isn't active
			var activeButton = filterContainer.querySelector('.filter-button.open');
			if(activeButton){
				activeButton.classList.remove('open');
			}

			var category = button.getAttribute('data-category');

			if(buttonOpen){
				button.classList.remove('open');
				filterDrawer.setAttribute('data-category', '');

				if(filterDrawerOpen){
					isoTest.filterDrawerClick(false);
				}
				if(isRealClick){
					isoTest.fireTag(button, 'RW:CarClass:Filter:' + category + '_quick_filter:collapse');
				}
			}else{
				button.classList.add('open');
				filterDrawer.setAttribute('data-category', category);
				isoTest.lastCategory = category;

				if(!filterDrawerOpen){
					isoTest.filterDrawerClick(false);
				}
				if(isRealClick){
					isoTest.fireTag(button, 'RW:CarClass:Filter:' + category + '_quick_filter:expand');
				}
			}
		},
		addFilterCategoryEvents : function(){
			var filterContainer = document.querySelector('.vehicle-select__controls.update');
				
			// v2 category filter buttons
			var filterButtons = filterContainer.querySelectorAll('.filter-button');
			
			// Add event listeners for each of our category filter buttons
			filterButtons.forEach(function(button){
				button.addEventListener('click', function(e){
					isoTest.quickFilterClick(button, true);
				});
			});
		},
		addFilterContainerEvents : function(){
			var filterContainer = document.querySelector('.vehicle-select__controls.update');
			var filterButton = filterContainer.querySelector('.filters-drawer__count button.btn-link');

			// Opens and closes the filter drawer
			filterButton.addEventListener('click', function(e){
				isoTest.filterDrawerClick(true);
			});

			// v2 category button events
			isoTest.addFilterCategoryEvents();
		},
		addFilterContainer : function(){
			var filterContainer = `
				<div class="vehicle-select__controls update">
					<div class="filters-drawer input-option--larger-on-large input-option--larger-on-medium" role="presentation">
						<div class="filters-drawer__count">
							<button aria-controls="filtersDrawer" aria-expanded="false" class="btn-link btn-toggle js-filters-button">Filters<span class="btn-link__text"></span></button>
							<span class="filters-drawer__results">0 Results</span>
							<button class="filter-button js-toggle-vehicle" data-category="vehicle">Vehicle <span class="count"></span></button>
							<button class="filter-button js-toggle-mileage" data-category="mileage">Mileage <span class="count"></span></button>
							<button class="filter-button js-toggle-seats" data-category="seats">Seats <span class="count"></span></button>
							<button class="filters-drawer__count__btn-reset hide">
								<span class="filters-drawer__count__btn-reset-text">Clear all</span>
							</button>
						</div>
						<div id="updatedFiltersDrawer" class="filters-drawer__form-wrap drawer-animation__content" aria-hidden="true">
							<form class="filters-drawer__form">
								<div class="clearfix"></div>
								<fieldset class="filters-drawer__buttons cancel-and-apply-buttons cancel-and-apply-buttons--3-and-2-of-12">
									<button type="submit" disabled="" class="btn">Apply</button><button type="button" disabled="" class="btn btn--opaque btn--underline">clear</button>
								</fieldset>
							</form>
						</div>
					</div>
				</div>
			`;
			
			var existingFilter = document.querySelectorAll('.vehicle-select__controls');
			if(existingFilter.length === 1){
				existingFilter[0].insertAdjacentHTML('afterend', filterContainer);

				isoTest.addFilterContainerEvents();
			}
		},
		init : function() {
			if (_satellite && typeof _satellite.setVar === 'function' && typeof _satellite.track === 'function') {
				_satellite.setVar('TargetCampaign', isoTest.test);
				_satellite.setVar('TargetCreative', isoTest.creative);
			}

			isoTest.log('Test Running...');
			isoTest.log(isoTest.account + ' - ' + isoTest.portfolio);
			isoTest.log(isoTest.test + ' - ' + isoTest.creative);

			helpers.elementLoaded(isoTest.selector, function() {
				isoTest.log('Test Ready!');

				var width = window.innerWidth;
				if(width > 912){
					document.documentElement.classList.add('desktop');
  				isoTest.chall();
				}
			});
		},
		chall : function() {
			isoTest.updateCarsObject();
			isoTest.observeEachCar();
		},
		fireTag : function(element, value) {
			var linkName = value ? value : element.innerText;
				linkName = isoTest.test ? isoTest.test + ' : ' + linkName : linkName;
			s.linkTrackVars = 'eVar20';
			s.eVar20 = linkName;
			s.tl(this, 'o', linkName);
		},
		log : function(obj){
			if(isoTest.debug === true){
				console.log(obj);
			}
		}
	};

	var helpers = {
		elementLoaded : function (ele, callback) {
			isoTest.log('elementLoaded::  ' + ele + ' - Checking...');
			window.clearTimeout(isoTest.eleTimer);
			if (document.querySelectorAll(ele).length > 0) {
				if (typeof callback === 'function') {
					isoTest.log('elementLoaded::  ' + ele + ' - Found!');
					callback();
				}
	    } else {
				isoTest.eleTimer = window.setTimeout(function(){helpers.elementLoaded(ele, callback);}, 100);
			}
		}
	};

	isoTest.init();
})();
</script>
