<style>.iso-modal-open{height:100%;overflow:hidden}.iso-load{background:rgba(255,255,255,.9);height:200px;left:0;position:absolute;top:0;width:100%;z-index:3}.iso-load .loading{top:50%}.ima-col-wrap{margin-bottom:60px;overflow:hidden}.ima-col-6{border:1px solid #ddd;float:left;padding:25px 35px;width:50%}.ima-pickup{position:relative}.ima-pickup::after{background-color:#fff}</style><script>(function() {
	'use strict';
	var isoTest = {
		account : 'EHI',
		portfolio : 'Enterprise',
		test : 'Homepage Abandoned Cart',
		creative : 'Challenger 1',
		selector: '#book',
		modal: '<div role="dialog" aria-modal="true" aria-labelledby="global-modal-title" class="iso-modal-abandon modal-container" aria-describedby="global-modal-content" tabindex="0">\
					<div class="modal-content">\
						<div class="modal-header">\
							<span id="global-modal-title">Welcome back</span>\
							<button id="iso-close-modal" class="close-modal" aria-label="Close" tabindex="0"><i class="icon icon-close-x-white">X</i></button>\
						</div>\
						<div class="modal-body cf">\
							<div>\
								<div class="global-modal__actions" id="global-modal-content">\
									<div>\
										<h2 class="ima-header">Do you want to continue?</h2>\
										<div class="ima-content">\
											<div class="iso-load hide"><div class="loading"></div></div>\
											<div class="ima-col-wrap">\
												<div class="ima-col-6 ima-pickup"><h5 class="ima-content-title">PICK-UP</h5><p class="ima-pickup-location">{pickuplocation}</p><p class="ima-pickup-date">{pickupdate}</p><p class="ima-pickup-time">{pickuptime}</p></div>\
												<div class="ima-col-6 ima-return"><h5 class="ima-content-title">RETURN</h5><p class="ima-return-location">{returnlocation}</p><p class="ima-return-date">{returndate}</p><p class="ima-return-time">{returntime}</p></div>\
											</div>\
											<div class="ima-btn-wrap">\
												<button class="btn btn-cancel">Discard</button>\
												<a class="btn btn-primary" href="">Continue</a>\
											</div>\
										</div>\
									</div>\
								</div>\
							</div>\
						</div>\
					</div>\
				</div>',
		deeplink : '
		tabbableElements : 'a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]',			
		init : function() {

			
			
			if (_satellite && typeof _satellite.setVar === 'function' && typeof _satellite.track === 'function') {
				_satellite.setVar('TargetCampaign', isoTest.test);
				_satellite.setVar('TargetCreative', isoTest.creative);
				
			}

			
			
			

			helpers.elementLoaded(isoTest.selector, function() {
				window.setTimeout(function(){
					
					if (typeof ReservationStateTree.data.session.reservationSession.reservationsInitiateRequest != "undefined") {
						if (typeof ReservationStateTree.data.session.reservationSession.reservationsInitiateRequest.pickupLocation.name != "undefined") {
							if (sessionStorage.getItem("isoTestMVT120") === null) {
								
		  						isoTest.chall();
		  					}
		  				}
	  				}
	  			}, 1200);
			});
			
		},
		chall : function() {

			
			sessionStorage.setItem('isoTestMVT120', 'true');

			
			var pickupLocation = ReservationStateTree.get(['session','reservationSession','reservationsInitiateRequest','pickupLocation','name']);
			var returnLocation = ReservationStateTree.get(['session','reservationSession','reservationsInitiateRequest','returnLocation','name']);
			var pickupDate = new Date(ReservationStateTree.get(['session','reservationSession','reservationsInitiateRequest','pickup_time']));
			var returnDate = new Date(ReservationStateTree.get(['session','reservationSession','reservationsInitiateRequest','return_time']));
			
			var dateOptions = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',};
			
			var pickupDateFormatted = pickupDate.toLocaleDateString('en-US', dateOptions);
			var returnDateFormatted = returnDate.toLocaleDateString('en-US', dateOptions);
			var pickupTimeFormatted = pickupDate.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
			var returnTimeFormatted = returnDate.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' });
			
			var modal = helpers.supplant(isoTest.modal, {
				'pickuplocation' : pickupLocation,
				'returnlocation' : returnLocation,
				'pickupdate' : pickupDateFormatted,
				'returndate' : returnDateFormatted,
				'pickuptime' : pickupTimeFormatted,
				'returntime' : returnTimeFormatted,
			});


			
			var pickupID = ReservationStateTree.get(['session','reservationSession','reservationsInitiateRequest','pickup_location_id']);
			var returnID = ReservationStateTree.get(['session','reservationSession','reservationsInitiateRequest','return_location_id']);
			var pickupDateShort = pickupDate.toLocaleDateString();
			var returnDateShort = returnDate.toLocaleDateString();
			var pickupTimeShort = pickupDate.toLocaleTimeString('en-US', { hour12: false });
			var returnTimeShort = returnDate.toLocaleTimeString('en-US', { hour12: false });

			var deeplinkURL = helpers.supplant(isoTest.deeplink, {
				'pickupID' : pickupID,
				'returnID' : returnID,
				'pickupDateShort' : pickupDateShort,
				'returnDateShort' : returnDateShort,
				'pickupTimeShort' : pickupTimeShort,
				'returnTimeShort' : returnTimeShort,
			});


			
			if(!document.querySelector('.iso-modal-abandon')){
				document.querySelector('body').insertAdjacentHTML('beforeend', modal);
				isoTest.bindModalEvents();
			}
			
			document.querySelector('.ima-btn-wrap .btn-primary').setAttribute('href', deeplinkURL);

			
			isoTest.showModal();

		},
		bindModalEvents: function(){
			
			document.addEventListener('keydown',function(e){
				if(e.keyCode == 27 || e.key == 'Esc' || e.key == 'Escape') {
					isoTest.hideModal();
				}
			});

			
			window.addEventListener('click', function (event) {
				if (event.target.closest('#iso-close-modal')) {
					isoTest.fireTag(this,'Modal Close');
					isoTest.hideModal();
				}
				if (event.target.matches('.ima-btn-wrap .btn-cancel')) {
					isoTest.fireTag(this,'Modal Discard');
					isoTest.hideModal();
				}
				if (event.target.closest('.ima-btn-wrap .btn-primary')) {
					isoTest.fireTag(this,'Modal Continue');
				}
			}, false);

		},
		showModal: function () {
			helpers.elementLoaded('.iso-modal-abandon', function(){
				var propName = isoTest.test + ' : Modal Open';
				s.linkTrackVars = 'prop23';
				s.prop23 = propName;
				s.tl(this, 'o', propName);

				document.querySelector('.iso-modal-abandon').classList.add('active');
				document.querySelector('.iso-load').classList.add('hide');

				document.querySelector('html').classList.add('iso-modal-open');
				var modalFocus = document.querySelector('.iso-modal-abandon.active');

				modalFocus.focus();

		      	isoTest.keepFocus(modalFocus);

		      	setTimeout(function(){document.getElementById('iso-close-modal').focus(); }, 500);
			});
		},
		hideModal : function () {
			document.querySelector('html').classList.remove('iso-modal-open');
			document.querySelector('.iso-modal-abandon').classList.remove('active');
		},
		keepFocus : function(context) {
	      var allTabbableElements = context.querySelectorAll(isoTest.tabbableElements),
	          firstTabbableElement = allTabbableElements[0],
	          lastTabbableElement = allTabbableElements[allTabbableElements.length - 1];

	      var keyListener = function(e) {
	    		var keyCode = e.which || e.keyCode;

	    		e.preventDefault = e.preventDefault || function () {
	    			e.returnValue = false;
	    		};
	    		if (keyCode === 9) {
			        if (e.target === lastTabbableElement && !e.shiftKey) {
	    				e.preventDefault();
	    				firstTabbableElement.focus();
			        } else if (e.target === firstTabbableElement && e.shiftKey) {
	    				e.preventDefault();
	    				lastTabbableElement.focus();
	    			}
	    		}
	    	};
	    	context.addEventListener('keydown', keyListener, false);
	    },
		fireTag : function(element, value) {
			var linkName = value ? value : element.innerText;
				linkName = isoTest.test ? isoTest.test + ' : ' + linkName : linkName;
			s.linkTrackVars = 'eVar20';
			s.eVar20 = linkName;
			s.tl(this, 'o', linkName);
		},
		log : function(obj){
			if(isoTest.debug === true){
				console.log(obj);
			}
		}
	}

	var helpers = {
		elementLoaded : function (ele, callback) {
			
			window.clearTimeout(isoTest.eleTimer);
			if (document.querySelectorAll(ele).length > 0) {
				if (typeof callback === 'function') {
					
					callback();
				}
	        } else {
	            isoTest.eleTimer = window.setTimeout(function(){helpers.elementLoaded(ele, callback);}, 100);
	        }
		},
		supplant : function(str, o) {
			return str.replace(/{([^{}]*)}/g, function(a, b) {
		        var p = b.split(/\./),
		            c = o;
		        for (var i = 0; i < p.length; i++) {
		          if (c[p[i]] == null)
		            return a;
		          c = c[p[i]];
		        }
				return typeof c === 'string' || typeof c === 'number' ? c : a;
			});
		}
	}

	isoTest.init();
})();</script>