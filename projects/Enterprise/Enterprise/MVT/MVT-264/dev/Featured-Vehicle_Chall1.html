<style>
	/* add this to hide tag when outside of designated location */
	.iso-preSelectedClass.iso-hide .rs-callout.rs-callout--highlight {
		display: none;
	}

	.vehicle-enough-points.cf,
	.vehicle-not-enough-points {
		margin-right: -15px;
		margin-top: -3px;
	}

	.vehicle-list.iso-featured {
		display: flex;
		flex-flow: wrap;
	}

	.vehicle-list__item {
		order: 0;
		width: 100%;
	}

	.vehicle-list__item.iso-preSelectedClass .vehicle-item {
		padding-right: 15px;
		/* margin-right: -15px; */
	}

	.iso-tag {
		background: #0A643A;
		color: #fff;
		display: block;
		font-size: 14px;
		padding: 4px 8px 1px 8px;
		width: calc(100% + 15px);
	}

	.iso-unavailable-msg {
		background: #f2f2f2;
		border-bottom: .125rem solid #c3c3c3;
		display: block;
		font-size: 14px;
		padding: 15px 20px;
		width: 100%;
	}

	/* Pre-selected styles */
	.iso-preSelectedClass.iso-preSelectedClass-filtered {
		margin-top: 0;
	}

	.iso-preSelectedClass-filtered .iso-tag {
		display: none;
	}

	.iso-preSelectedClass-filtered .vehicle-item.is-search-by-filter,
	.iso-preSelectedClass-filtered .vehicle-item.is-pre-selected {
		border-color: #169a5a;
	}

	.iso-preSelectedClass {
		margin-top: 7px;
	}

	.iso-tag {
		display: inline;
		font-size: 12px;
		font-weight: 600;
		padding: 4px 15px;
		position: relative;
		width: auto;
	}

	.iso-tag:after {
		border-left: 6px solid transparent;
		border-right: 6px solid transparent;
		border-top: 6px solid #0A643A;
		bottom: -6px;
		content: " ";
		height: 0;
		left: 20px;
		position: absolute;
		width: 0;
	}

	/* potentially fixes sorting issue */
	.vehicle-list__item .vehicle-item {
		width: 100%;
	}

	.vehicle-select__main .vehicle-list {

		display: flex;
		flex-direction: column;
	}

	.vehicle-header__sort-by:not(.Iso) {
		display: none;
	}

	.vehicle-list .vehicle-list__item {
		display: flex;
	}

	/* default featured color */
	/* .iso-preSelectedClass .rs-callout.rs-callout--highlight {
		border-left: 4px solid #ce810d;
	} */

	.iso-preSelectedClass .rs-callout--highlight .rs-callout__icon {
		fill: #c96d1f;
	}

	/* reduces whitespace*/
	.iso-preSelectedClass .vehicle-item {
		padding: 1rem;
		padding-bottom: 0rem;
	}

	.iso-preSelectedClass .rs-icon {
		width: 1em;
		height: 1em;
	}

	/* take from this line downwards to address spacing and font issues for desktop, tablet and mobile */
	@media (max-width:1135px) {
		.iso-preSelectedClass .rs-callout.rs-callout--highlight {
			font-size: 12px;
		}

		/* increases whitespace*/
		.iso-preSelectedClass .vehicle-item {
			padding: 1rem;
		}
	}

	/* for desktop down */
	@media (max-width: 1081px) {

		.vehicle-enough-points.cf,
		.vehicle-not-enough-points {
			margin-right: 0;
		}

		.vehicle-list__item.iso-preSelectedClass .vehicle-item {
			padding-right: 0;
			margin-right: 0;
		}

		.iso-tag {
			margin-left: 5px;
			width: 100%;
		}
	}

	/* for tablet */
	@media (max-width: 1081px) and (min-width: 768px) {

		/* lines up pricing */
		.iso-preSelectedClass .vehicle-item__pricing {
			margin-right: 35px;
		}

	}

	/* for tablet */
	@media (max-width: 768px) and (min-width: 654px) {

		/* lines up pricing */
		.iso-preSelectedClass .vehicle-item__pricing {
			margin-right: 20px;
		}
	}

	@media (max-width: 653px) {

		.iso-preSelectedClass .vehicle-item__main-content .vehicle-item__summary .rs-callout.rs-callout--highlight {
			margin-bottom: 5%;
		}

		.vehicle-list__item.iso-preSelectedClass .vehicle-item {
			padding-right: 15px
		}

		.iso-preSelectedClass img {
			/* margin-top: 45px; */
			margin-top: 0px;
		}
	}
</style>
<script>
	(function () {
		'use strict';
		var isoTest = {
			debug: false,
			account: 'Enterprise',
			portfolio: 'Enterprise.com',
			test: 'Featured Vehile 2.0',
			creative: 'Challenger 1',
			selector: "MVT695B",
			selector2: "MVT695C",
			filters: '.vehicle-filter__header-cta .vehicle-filter__header-link',
			vehicleItem: '.vehicle-list__item',
			preSelected: '.vehicle-item.is-search-by-filter, .vehicle-item.is-pre-selected',
			template: '<span class="rs-callout rs-callout--highlight"><span class="rs-callout__icon-container"><i role="img" aria-hidden="true" class="rs-callout__icon rs-icon"><svg viewBox="0 0 22 20"><use xlink:href="#icn-star2"></use></svg></i></span><span class="rs-callout__label">{tag}</span></span>',
			mostPopExists: false,
			topReserveSipArr: [
				"FCAR",
				"ICAR",
				"IFAR",
				"CCAR",
				"SCAR",
				"MVAR",
				"ECAR",
				"SFAR",
				"FFAR",
				"PPAR",
				"CFAR",
				"PCAR",
				"PFAR",
				"SPAR",
				"XXAR",
				"FVAR",
				"LCAR",
				"PGAR",
				"STAR",
				"SSAR",
				"UFAR",
				"PXAR",
				"FJAR",
				"GXAR",
				"RVAR",
				"LYMR",
				"RFAR",
				"SFDR",
				"WFAR",
				"LFAR",
				"WZAR",
				"SKAR",
				"IFDR",
				"IJAR",
				"UXAR",
				"WCAR",
				"WXAR",
				"RXAR",
				"WCAE",
				"SYMR",
				"GXAE",
				"FFDR",
				"ICAE",
				"PFDR",
				"SVAR",
				"CFDR",
				"PPBR",
				"GYMR",
				"EYMR",
				"XFAR",
				"PGDR",
				"FCAH",
				"FYMR",
				"UVAR",
				"UDAR",
				"OFAR",
				"SCAH",
				"JKAR",
				"IYMR",
				"WDAR",
				"PYMR",
				"XFAV",
				"GKAR",
				"PSAR",
				"LFDR",
				"OVAR",
				"UZAR",
				"CFAE",
				"OQBD",
				"SPBR",
				"RKAR",
				"USAR",
				"PQAR",
				"LSAR",
				"LTAR",
				"XSAR",
				"WSAR",
				"OQAR",
				"XEAR",
				"OPBD",
				"XGAR",
				"XVAR",
				"CTAR",
				"ITAR",
				"XZAR",
				"SGAR",
			],
			availCarSippArr_In_Order: [],
			featured: {
				0: {
					car: 'ICAE',
					tag: '<strong>Try Something New!</strong>',
					shortTag: 'Try Something New'
				},
				1: {
					car: 'ICAE',
					tag: '<strong>Try Something New!</strong>',
					shortTag: 'Try Something New'
				},
				2: {
					car: 'ICAE',
					tag: '<strong>Try Something New!</strong>',
					shortTag: 'Try Something New'
				},
				3: {
					car: 'ICAE',
					tag: '<strong>Try Something New!</strong>',
					shortTag: 'Try Something New'
				},
				4: {
					car: 'ICAE',
					tag: '<strong>Try Something New!</strong>',
					shortTag: 'Try Something New'
				},
				5: {
					car: 'ICAE',
					tag: '<strong>Try Something New!</strong>',
					shortTag: 'Try Something New'
				},
				6: {
					car: 'ICAE',
					tag: '<strong>Try Something New!</strong>',
					shortTag: 'Try Something New'
				}
			},
			altCar: 'IFAR',
			audience: {
				group: ['32', '23', '30', '16']
			},
			sortOptions: [
				{ index: 0, value: "Recommended", text: "Featured", selected: false },
				{ index: 3, value: "Most Popular", text: "Most Popular", selected: false },
				{ index: 1, value: "Low to High", text: "Low to High", selected: false },
				{ index: 2, value: "High to Low", text: "High to Low", selected: false },
			],
			sortOptionsC: [
				{ index: 3, value: "Most Popular", text: "Most Popular", selected: false },
				{ index: 0, value: "Recommended", text: "Featured", selected: false },
				{ index: 1, value: "Low to High", text: "Low to High", selected: false },
				{ index: 2, value: "High to Low", text: "High to Low", selected: false },
			],
			sortOptionsControl: [
				{ index: 0, value: "Recommended", text: "Featured", selected: false },
				{ index: 1, value: "Low to High", text: "Low to High", selected: false },
				{ index: 2, value: "High to Low", text: "High to Low", selected: false },
			],
			mobileOptions: [
				{ index: 0, value: "Recommended", text: "Featured", selected: false },
				{ index: 3, value: "Most Popular", text: "Most Popular", selected: false },
				{ index: 1, value: "Low to High", text: "Low to High", selected: false },
				{ index: 2, value: "High to Low", text: "High to Low", selected: false },
			],
			featAvail: false,
			init: function () {

				isoTest.debug = Boolean(helpers.getQueryParam('debug'));

				isoTest.log('Test Running...');
				isoTest.log(isoTest.account + ' - ' + isoTest.portfolio);
				isoTest.log(isoTest.test + ' - ' + isoTest.creative);

				isoTest.elementLoaded(isoTest.vehicleItem, function () {
					isoTest.log('Test Ready!');
					if (!ReservationStateTree.get(['model', 'carSelect', 'selectedCar'])) {
						isoTest.chall();
					}
				});

				window.addEventListener('ttFeatVehicle', isoTest.labelVehicle, false);

				const spinnerUpdate = new MutationObserver(function (mutationsList) {
					mutationsList.forEach(function (mutation) {
						mutation.removedNodes.forEach(function (removedNode) {
							if (removedNode.classList !== undefined && removedNode.classList.contains("transition")) {
								isoTest.elementLoaded(".vehicle-list .vehicle-list__item:last-child", function () {
									isoTest.chall();
									isoTest.hideBanner();
									setTimeout(isoTest.checkSort, 200);
								});
							}
						});
					});
				});
				spinnerUpdate.observe(document.querySelector("body"), { subtree: true, childList: true });

				var removedMobileBanner = new MutationObserver(function (mutationsList) {
					mutationsList.forEach(function (mutation) {
						mutation.removedNodes.forEach(function (removedNode) {
							if (removedNode.classList !== undefined) {
								if (removedNode.classList.contains('ReactModal__Overlay--after-open')) {
									// console.log(removedNode.classList, "<<< these are all teh removed nodes")
									isoTest.hideBanner();
								}
							}
						});
					});
				});

				removedMobileBanner.observe(document.querySelector('body'), { subtree: true, childList: true });

				// Search filter bug fix
				isoTest.observeEl('.is-search-by-filter.rs-tag-container--darkGreen', function (el) {
					var vehicleItem = el.closest('.vehicle-list__item');
					if (vehicleItem.classList.contains('iso-preSelectedClass-filtered')) {
						var featuredTag = vehicleItem.querySelector('.rs-callout');
						if (featuredTag) {
							featuredTag.style.display = 'none';
						}
					}
				});

				isoTest.observeEl('.vehicle-filter__content .vehicle-filter__filter:last-child .vehicle-filter__filter-list-item:last-child', async function (el) {
					const rsCheckboxInputs = document.querySelectorAll(".vehicle-filter__filter-list-item input");

					rsCheckboxInputs.forEach(rs => {
						rs.addEventListener('change', function (e) {
							setTimeout(() => {
								isoTest.chall();
								isoTest.hideBanner();
							}, 1.5);
						});
					});
				});

				// adds filter box fix where featured vehicle reappears
				isoTest.observeEl('.vehicle-filter__header-cta button', async function (el) {
					const clearAll = document.querySelector(".vehicle-filter__header-cta button");
					clearAll.addEventListener('click', function (e) {
						isoTest.hideBanner();
					});
				});

			},
			chall: function () {
				isoTest.log('chall()');
				isoTest.branchType = ReservationStateTree.get(['session', 'reservationSession', 'pickup_location', 'location_type']);
				var groupNumber = store.getState().toJS().app.baobab.session.reservationSession.pickupLocationWithDetail.location_id.slice(0, 2);
				var isGroup = isoTest.checkGroup(groupNumber);
				isoTest.log('isGroup:: ' + isGroup);

				if (isGroup) {
					isoTest.runTest();
				}
				// adds fix for filter buttons
				isoTest.observeEl('.ReactModal__Overlay--after-open.rs-modal__overlay', function () {
					isoTest.observeEl('.rs-modal__buttons-container button:last-child', function () {
						const discardBtn = document.querySelector(".rs-modal__buttons-container button:last-child");
						discardBtn.addEventListener("click", function () {
							localStorage.removeItem('greenSelected');
						})
					});
				});
			},
			/* add this to hide tag when outside of designated location */
			hideBanner: function () {

				setTimeout(() => {

					isoTest.observeEl('.iso-preSelectedClass', function () {

						const groupId = store.getState().toJS().app.baobab.session.reservationSession.pickupLocationWithDetail.location_id.slice(0, 2);
						const filteredReservation = isoTest.audience.group.filter(g => g == groupId);


						if (!filteredReservation.length) {
							document.querySelector('.iso-preSelectedClass').classList.add("iso-hide");
						}
						if (filteredReservation.length) {
							document.querySelector('.iso-preSelectedClass').classList.remove("iso-hide");
						}

					})

					isoTest.observeEl('.rs-tag-container.is-selected', function () {
						// console.log("show preselected observe L");
						localStorage.setItem('greenSelected', true);
						isoTest.observeEl('.iso-preSelectedClass', function () {
							document.querySelector('.iso-preSelectedClass').classList.add("iso-hide");
						})
					})

					const greenSelected = localStorage.getItem('greenSelected');

					if (greenSelected) {
						isoTest.observeEl('.iso-preSelectedClass', function () {
							document.querySelector('.iso-preSelectedClass').classList.add("iso-hide");
						})
					};
				}, 50);
			},
			checkGroup: function (groupNumber) {
				isoTest.log('checkGroup()');
				var checksOut = false;
				isoTest.audience.group.forEach(function (g) {
					if (groupNumber.substring(0, g.length) == g) {
						checksOut = true;
					}
					else {
						isoTest.hideBanner();
					}
				});
				return checksOut;
			},
			runTest: function () {
				isoTest.log('runTest()');
				isoTest.day = helpers.getQueryParam('dayOverride') ? helpers.getQueryParam('dayOverride') : new Date(ReservationStateTree.get(['session', 'reservationSession', 'pickup_time'])).getDay();
				isoTest.vehicleClass = isoTest.featured[isoTest.day];
				isoTest.onLoadpreSelected = document.querySelectorAll(isoTest.preSelected).length > 0;
				isoTest.checkSort();

				// Filters and sort
				var filterElements = document.querySelectorAll('.vehicle-filter__filter .form-checkbox,.vehicle-filter__header-link, .vehicle-redemption__options-cta, .iso-pay');
				for (var i = 0; i < filterElements.length; i++) {
					filterElements[i].addEventListener('click', function () {
						isoTest.log('Event: Filter Checkbox Click');
						setTimeout(isoTest.checkSort, 200);
					}, false);
				}

				document.addEventListener('click', function (e) {
					if (e.target.matches('[data-dtm-tracking^="cars|filter_modal|submit"]') || e.target.matches('[data-dtm-tracking^="car_filters|clear_filters|select"]')) {
						if (!ReservationStateTree.get(['model', 'carSelect', 'selectedCar'])) {
							isoTest.checkSort();
						}
					}
				});
				/* add this to hide tag when outside of designated location */
				if (document.querySelector(".vehicle-header__sort-by .rs-input .rs-select.Iso")) {
					document.querySelector(".vehicle-header__sort-by .rs-input .rs-select.Iso").addEventListener(
						"change",
						function (e) {
							setTimeout(() => {
								document.querySelector(".rs-input__field.rs-select:not(.Iso)").value = e.target.value;
								isoTest.checkSort();
								isoTest.hideBanner();
							}, 200);
						}, false);
				}
			},
			spinnerChange: function () {
				isoTest.observeEl(".vehicle-header__info-group", function () {
					isoTest.chall();
				});
			},
			recommendedSort: function (sort, list) {
				isoTest.elementLoaded(".iso-preSelectedClass", function () {
					const filteredList = [];
					list.forEach((l) => {
						const listItems = l.querySelector(".vehicle-item");
						if (listItems.classList.contains("rs-tag-container")) {
							filteredList.push(l);
						}
					});

					if (filteredList.length > 0) {
						document.querySelector(".iso-preSelectedClass").style.order = filteredList.length;
						list.forEach((l, index) => {
							if (!l.querySelector(".vehicle-item").classList.contains("rs-tag-container") && !l.classList.contains("iso-preSelectedClass")) {
								l.style.order = index + filteredList.length;
							}
						});
					} else {
						document.querySelector(".iso-preSelectedClass").style.order = -1;
					}

				});
			},
			mostPopSort: function (sort) {
				isoTest.elementLoaded(".iso-preSelectedClass", function () {
					isoTest.availCarSippArr_In_Order = [];
					setTimeout(() => {
						isoTest.orderCars(sort);
					}, 5);
				});
			},
			updateSearchData: function () {
				const radioButtons = document.querySelectorAll(".vehicle-filter__filter__radio.rs-radio > input[name='vehicleSortBy']");
				for (let index = 0; index < radioButtons.length; index++) {
					const element = radioButtons[index];
					if (element.checked) {
						const activeRadio = element;
						if (activeRadio.value == "High to Low" || activeRadio.value == "Low to High") {
							isoTest.elementLoaded(".iso-preSelectedClass", function () {
								const preSelectedList = document.querySelector(".iso-preSelectedClass");
								const dtmAttr = preSelectedList.getAttribute("data-dtm-tracking");
								const currentOrder = dtmAttr.split("|").slice(-1);
								setTimeout(() => {
									preSelectedList.style.order = currentOrder;
								}, 1.5);
							});
							const event = new Event("change", {
								bubbles: true,
							});
							document.querySelector(".rs-input__field.rs-select:not(.Iso)").dispatchEvent(event);
						}
						if (activeRadio.value === "Most Popular") {
							isoTest.mostPopSort(activeRadio);
						}
					}
				}
			},
			allMobileSort: function () {
				const vehicleHeaderText = document.querySelector(".vehicle-header__sorted-by");
				isoTest.mobileOptions.forEach((s) => {
					if (s.selected) {
						vehicleHeaderText.innerText = "Sorted By: " + s.text;
					}
				});

				const selected = isoTest.mobileOptions.filter((m) => m.selected === true);

				if (selected[0].value == "High to Low" || selected[0].value == "Low to High") {
					isoTest.elementLoaded(".iso-preSelectedClass", function () {
						const preSelectedList = document.querySelector(".iso-preSelectedClass");
						const dtmAttr = preSelectedList.getAttribute("data-dtm-tracking");
						const currentOrder = dtmAttr.split("|").slice(-1);
						setTimeout(() => {
							preSelectedList.style.order = currentOrder;
						}, 1.5);

						// setTimeout(() => {
						const event = new Event("change", {
							bubbles: true,
						});
						// console.log("selc", isoTest.mobileOptions);
						// console.log("high low val", document.querySelector(".rs-input__field.rs-select:not(.Iso)").value);
						document.querySelector(".rs-input__field.rs-select:not(.Iso)").dispatchEvent(event);
						// }, 20);
					});
				}
				/*  if (selected[0].value === "Most Popular") {
					  isoTest.mostPopSort(selected[0].value);
				  } */
				if (selected[0].value === "Recommended") {
					const radioButtons = document.querySelectorAll(".vehicle-filter__filter__radio.rs-radio > input[name='vehicleSortBy']");
					const list = document.querySelectorAll(".vehicle-list .vehicle-list__item");
					isoTest.recommendedSort(selected[0].value, list);
				}
			},
			checkSort: function () {
				const mediaQuery = window.matchMedia("(max-width: 1279px)");

				function handleTabletChange(e) {
					// Check if the media query is true
					if (e.matches) {
						// debugger;
						console.log("This is Mobile");
						isoTest.labelVehicle();
						isoTest.elementLoaded(".vehicle-header__sorted-by", function () {
							const vehicleHeaderText = document.querySelector(".vehicle-header__sorted-by");
							isoTest.mobileOptions.forEach((s) => {
								if (s.selected) {
									vehicleHeaderText.innerText = "Sorted By: " + s.text;
								}
							});
						});

						if (document.querySelector(".vehicle-header__sorted-by")) {
							const selectedVal = isoTest.mobileOptions.filter((m) => m.selected === true);

							if (!selectedVal.length || (selectedVal.length && selectedVal[0].value == "Recommended")) {
								setTimeout(() => {
									const radioButtons = document.querySelectorAll(".vehicle-filter__filter__radio.rs-radio > input[name='vehicleSortBy']");
									const list = document.querySelectorAll(".vehicle-list .vehicle-list__item");
									// console.log("selectedVal", selectedVal)
									isoTest.recommendedSort("Recommended", list);
								}, 201);
							} else if (selectedVal[0].value == "Most Popular") {
								setTimeout(() => {
									// console.log("selectedVal", selectedVal)
									isoTest.mostPopSort(selectedVal[0].value);
								}, 201);
							} else {
								if (document.querySelector(".iso-preSelectedClass")) {
									const preSelectedList = document.querySelector(".iso-preSelectedClass");
									const dtmAttr = preSelectedList.getAttribute("data-dtm-tracking");
									const currentOrder = dtmAttr.split("|").slice(-1);
									setTimeout(() => {
										// console.log("selectedVal", selectedVal)
										preSelectedList.style.order = currentOrder;
										const event = new Event("change", {
											bubbles: true,
										});
										document.querySelector(".rs-input__field.rs-select:not(.Iso)").dispatchEvent(event);
									}, 201);
								}
							}
						}

						isoTest.observeEl(".ReactModal__Overlay--after-open", () => {
							/*  const mostPopBtn =
								  '<label class="vehicle-filter__filter__radio rs-radio"><input aria-checked="false" type="radio" class="mobilePop" name="vehicleSortBy" value="Most Popular"><span class="rs-radio__text" aria-hidden="false">Most Popular</span></label>';
   */
							isoTest.elementLoaded(".vehicle-filter__header", function () {
								// this is offer B
								/* if (!document.querySelector(".mobilePop")) {
									 document
										 .querySelectorAll(".ReactModal__Overlay--after-open .vehicle-filter__filter")[0]
										 .firstChild.querySelectorAll(".rs-radio")[0]
										 .insertAdjacentHTML("afterend", mostPopBtn);
								 } */


								const radioButtons = document.querySelectorAll(".vehicle-filter__filter__radio.rs-radio > input[name='vehicleSortBy']");

								radioButtons.forEach((r) => {
									isoTest.mobileOptions.forEach((m) => {
										if (m.selected) {
											if (m.value == r.value) {
												r.checked = true;
											}
										}
									});
								});

								const list = document.querySelectorAll(".vehicle-list .vehicle-list__item");
								// loop through the radio buttons
								for (let i = 0; i < radioButtons.length; i++) {
									// listen for changes on each radio button
									const allRadio = radioButtons[i];
									radioButtons[i].addEventListener("change", function (e) {
										const radioValue = e.target.value;
										isoTest.mobileOptions = isoTest.mobileOptions.map((m) => {
											if (m.value == radioValue) {
												m.selected = true;
												m.value == radioValue;
												sessionStorage.setItem("radioSelected", m.selected);
												sessionStorage.setItem("radioValue", m.value);
											} else {
												m.selected = false;
											}
											return m;
										});

										setTimeout(() => {
											isoTest.allMobileSort();
										}, 10);
									});
								}

								const modalClose = document.querySelector(".rs-modal__wrapper .cta.cta--primary.cta--large.cta--noMargin");

								// modalClose.addEventListener("click", function (e) {
								//     isoTest.allMobileSort();
								// })
							});
						});

						const dollarCoin = document.querySelectorAll(".vehicle-redemption__options .vehicle-redemption__options-cta");
						for (let x = 0; x < dollarCoin.length; x++) {
							dollarCoin[x].addEventListener("click", function () {
								const selectedVal = isoTest.mobileOptions.filter((m) => m.selected === true);

								if (!selectedVal.length || (selectedVal.length && selectedVal[0].value == "Recommended")) {
									setTimeout(() => {
										const radioButtons = document.querySelectorAll(".vehicle-filter__filter__radio.rs-radio > input[name='vehicleSortBy']");
										const list = document.querySelectorAll(".vehicle-list .vehicle-list__item");
										isoTest.recommendedSort("Recommended", list);
									}, 201);
								} else {
									const preSelectedList = document.querySelector(".iso-preSelectedClass");
									const dtmAttr = preSelectedList.getAttribute("data-dtm-tracking");
									const currentOrder = dtmAttr.split("|").slice(-1);
									setTimeout(() => {
										preSelectedList.style.order = currentOrder;
									}, 201);
								}

								/*else if (selectedVal[0].value == "Most Popular") {
									setTimeout(() => {
										isoTest.mostPopSort(selectedVal[0].value);
									}, 201);
								} */
							});
						}
					} else {
						isoTest.elementLoaded(".vehicle-list", () => {
							const vehicleList = document.querySelector(".vehicle-list");


							if (vehicleList.classList.contains(isoTest.selector)) { //Offer B

								console.log('Variant B is running at the same time')

								console.log("This is Desktop!!");
								const vehicleHeaderInfo = document.querySelector(".vehicle-header__info-group");
								const vehicleSortBy = '<div class="vehicle-header__sort-by Iso"><label class="rs-label" for="vehicleSortBy"><span>Sort By</span></label><div class="rs-input"><select class="rs-input__field rs-select Iso" name="vehicleSortBy" aria-required="false" id="vehicleSortBy"></select></div></div>';
								if (!document.querySelector(".vehicle-header__sort-by.Iso .rs-select")) {
									vehicleHeaderInfo.insertAdjacentHTML("afterbegin", vehicleSortBy);
								}

								isoTest.elementLoaded(".vehicle-header__sort-by.Iso .rs-select", function () {
									const sort = document.querySelector(".vehicle-header__sort-by.Iso .rs-select");
									if (!sort.classList.contains("added")) {
										isoTest.sortOptions.forEach(s => {
											let option = document.createElement('option');
											option.innerHTML = s.text;
											option.value = s.value;
											option.selected = s.selected;
											option.setAttribute("data-index", s.index);
											sort.appendChild(option);
											sort.classList.add("added");
										})
									}

									const list = document.querySelectorAll(".vehicle-list .vehicle-list__item");
									const groupId = store.getState().toJS().app.baobab.session.reservationSession.pickupLocationWithDetail.location_id.slice(0, 2);
									const filteredReservation = isoTest.audience.group.filter((g) => g == groupId);
									isoTest.sortOptions = isoTest.sortOptions.map(s => {
										if (sort.value == s.value) {
											s.selected = true;
											s.value = sort.value;
										} else {
											s.selected = false;
										}
										return s;
									})

									if (sort.value == "Recommended") {
										isoTest.recommendedSort(sort, list);
									}

									if (sort.value == "High to Low" || sort.value == "Low to High") {
										isoTest.elementLoaded(".iso-preSelectedClass", function () {
											const preSelectedList = document.querySelector(".iso-preSelectedClass");
											const dtmAttr = preSelectedList.getAttribute("data-dtm-tracking");
											const currentOrder = dtmAttr.split("|").slice(-1);
											setTimeout(() => {
												preSelectedList.style.order = currentOrder;
											}, 1.5);
										});
										const event = new Event('change', {
											bubbles: true
										});
										document.querySelector(".rs-input__field.rs-select:not(.Iso)").dispatchEvent(event);
									}

									if (sort.value == "Most Popular") {
										isoTest.mostPopSort(sort);
									}

									isoTest.labelVehicle();

								})
							} else if (vehicleList.classList.contains(isoTest.selector2)) { // Offer C
								console.log("Variant C is running at the same time");

								console.log("This is Desktop!!");
								const vehicleHeaderInfo = document.querySelector(".vehicle-header__info-group");
								const vehicleSortBy =
									'<div class="vehicle-header__sort-by Iso"><label class="rs-label" for="vehicleSortBy"><span>Sort By</span></label><div class="rs-input"><select class="rs-input__field rs-select Iso" name="vehicleSortBy" aria-required="false" id="vehicleSortBy"></select></div></div>';
								if (!document.querySelector(".vehicle-header__sort-by.Iso .rs-select")) {
									vehicleHeaderInfo.insertAdjacentHTML("beforebegin", vehicleSortBy);
								}

								isoTest.elementLoaded(".vehicle-header__sort-by.Iso .rs-select", function () {
									const sort = document.querySelector(".vehicle-header__sort-by.Iso .rs-select");
									if (!sort.classList.contains("added")) {
										isoTest.sortOptionsC.forEach((s) => {
											let option = document.createElement("option");
											option.innerHTML = s.text;
											option.value = s.value;
											option.selected = s.selected;
											option.setAttribute("data-index", s.index);
											sort.appendChild(option);
											sort.classList.add("added");
										});
									}

									const list = document.querySelectorAll(".vehicle-list .vehicle-list__item");
									const groupId = store.getState().toJS().app.baobab.session.reservationSession.pickupLocationWithDetail.location_id.slice(0, 2);
									const filteredReservation = isoTest.audience.group.filter((g) => g == groupId);
									isoTest.sortOptionsC = isoTest.sortOptionsC.map((s) => {
										if (sort.value == s.value) {
											s.selected = true;
											s.value = sort.value;
										} else {
											s.selected = false;
										}
										return s;
									});

									if (sort.value == "Recommended") {
										isoTest.recommendedSort(sort, list);
									}

									if (sort.value == "High to Low" || sort.value == "Low to High") {
										isoTest.elementLoaded(".iso-preSelectedClass", function () {
											const preSelectedList = document.querySelector(".iso-preSelectedClass");
											const dtmAttr = preSelectedList.getAttribute("data-dtm-tracking");
											const currentOrder = dtmAttr.split("|").slice(-1);
											setTimeout(() => {
												preSelectedList.style.order = currentOrder;
											}, 1.5);
										});
										const event = new Event("change", {
											bubbles: true,
										});
										document.querySelector(".rs-input__field.rs-select:not(.Iso)").dispatchEvent(event);
									}

									if (sort.value == "Most Popular") {
										isoTest.mostPopSort(sort);
									}

									isoTest.labelVehicle();
								});
							} else if (!vehicleList.classList.contains(isoTest.selector) && !vehicleList.classList.contains(isoTest.selector2)) {
								console.log("Control");

								console.log("This is Desktop!!");
								const vehicleHeaderInfo = document.querySelector(".vehicle-header__info-group");
								const vehicleSortBy =
									'<div class="vehicle-header__sort-by Iso"><label class="rs-label" for="vehicleSortBy"><span>Sort By</span></label><div class="rs-input"><select class="rs-input__field rs-select Iso" name="vehicleSortBy" aria-required="false" id="vehicleSortBy"></select></div></div>';
								if (!document.querySelector(".vehicle-header__sort-by.Iso .rs-select")) {
									vehicleHeaderInfo.insertAdjacentHTML("beforebegin", vehicleSortBy);
								}

								isoTest.elementLoaded(".vehicle-header__sort-by.Iso .rs-select", function () {
									const sort = document.querySelector(".vehicle-header__sort-by.Iso .rs-select");
									if (!sort.classList.contains("added")) {
										isoTest.sortOptionsControl.forEach((s) => {
											let option = document.createElement("option");
											option.innerHTML = s.text;
											option.value = s.value;
											option.selected = s.selected;
											option.setAttribute("data-index", s.index);
											sort.appendChild(option);
											sort.classList.add("added");
										});
									}

									const list = document.querySelectorAll(".vehicle-list .vehicle-list__item");
									const groupId = store.getState().toJS().app.baobab.session.reservationSession.pickupLocationWithDetail.location_id.slice(0, 2);
									const filteredReservation = isoTest.audience.group.filter((g) => g == groupId);
									isoTest.sortOptionsControl = isoTest.sortOptionsControl.map((s) => {
										if (sort.value == s.value) {
											s.selected = true;
											s.value = sort.value;
										} else {
											s.selected = false;
										}
										return s;
									});

									if (sort.value == "Recommended") {
										isoTest.recommendedSort(sort, list);
									}

									if (sort.value == "High to Low" || sort.value == "Low to High") {
										isoTest.elementLoaded(".iso-preSelectedClass", function () {
											const preSelectedList = document.querySelector(".iso-preSelectedClass");
											const dtmAttr = preSelectedList.getAttribute("data-dtm-tracking");
											const currentOrder = dtmAttr.split("|").slice(-1);
											setTimeout(() => {
												preSelectedList.style.order = currentOrder;
											}, 1.5);
										});
										const event = new Event("change", {
											bubbles: true,
										});
										document.querySelector(".rs-input__field.rs-select:not(.Iso)").dispatchEvent(event);
									}


									isoTest.labelVehicle();
								});
							}

						});
					}
				}

				// Register event listener
				mediaQuery.addListener(handleTabletChange);

				// Initial check
				handleTabletChange(mediaQuery);
			},
			orderCars: async function (value) {
				const availCarsInDomArr = document.querySelectorAll(".vehicle-select__main>.vehicle-list .vehicle-list__item");

				const mostPopularFilter = document.querySelector(".vehicle-header__sort-by");

				const allCars = store.getState().toJS().gmi.ui.filters.car_classes.items.filtered;
				const availableCarList = allCars.filter((v) => v.status === "AVAILABLE_AT_RETAIL_RATE");
				var availCarSippArr = [];
				for (let i = 0; i < allCars.length; i++) {
					if (allCars[i].status === "AVAILABLE_AT_RETAIL_RATE") {
						availCarSippArr.push(allCars[i].code);
					}
				}
				for (let i = 0; i < isoTest.topReserveSipArr.length; i++) {
					if (availCarSippArr.includes(isoTest.topReserveSipArr[i])) {
						isoTest.availCarSippArr_In_Order.push(isoTest.topReserveSipArr[i]);
					}
				}

				let availableDOMVehicles = [];
				for (let i = 0; i < availableCarList.length; i++) {
					const index = isoTest.availCarSippArr_In_Order.findIndex((x) => x == availableCarList[i].code);
					availableCarList[i].sort_id = index;
				}

				availableCarList.sort((a, b) => a.sort_id - b.sort_id); // b - a for reverse sort
				const vItems = document.querySelectorAll(".vehicle-list .vehicle-list__item");
				availableCarList.forEach((h) => {
					vItems.forEach((v) => {
						const attrb = v.getAttribute("data-dtm-tracking");
						if (attrb.includes(h.code)) {
							const order = attrb.split("|")[4];
							v.style.order = parseInt(h.sort_id);
							availableDOMVehicles.push(v);
						}
					});
				});
			},
			labelVehicle: function () {
				isoTest.log('labelVehicle()');
				isoTest.vehicleItems = document.querySelectorAll('.vehicle-list > li');
				isoTest.lastPreselectedIndex = document.querySelectorAll(isoTest.preSelected).length - 1;
				isoTest.lastPreselected = document.querySelectorAll(isoTest.preSelected)[isoTest.lastPreselectedIndex];
				if (isoTest.lastPreselected) {
					var vehicleItems = Array.prototype.slice.call(isoTest.vehicleItems);
					isoTest.lastPreselectedIndex = vehicleItems.indexOf(isoTest.lastPreselected.parentNode);
				}
				isoTest.findVehicle(isoTest.vehicleClass.car);
				if (document.querySelectorAll('.iso-preSelectedClass').length == 0 && isoTest.altCar && !isoTest.featAvail) {
					isoTest.findVehicle(isoTest.altCar);
				}
				isoTest.reOrder();
			},
			findVehicle: function (featClass) {
				for (var i = 0; i < isoTest.vehicleItems.length; i++) {
					if (!isoTest.vehicleItems[i].classList.contains('iso-preSelectedClass') && isoTest.vehicleItems[i].classList.contains('vehicle-list__item')) {
						var dataInfo = isoTest.vehicleItems[i].getAttribute('data-dtm-tracking').split('|');
						var carClass = dataInfo[1];
						var avail = dataInfo[2];
						isoTest.log(carClass + ' :: ' + avail);
						if (carClass == featClass && (avail != 'SOLD_OUT' && avail != 'RESTRICTED_AT_RETAIL_RATE')) {
							isoTest.addPreselect(isoTest.vehicleItems[i]);
							isoTest.featAvail = carClass == isoTest.altCar ? false : true;
						}
					}
				}
			},
			addFeaturedOrange: function () {
				isoTest.observeEl('.rs-callout.rs-callout--highlight', function () {
					//Fix the orange tag showing when filter is used on a Green Featured item!

					const newTag = document.querySelector(".rs-callout.rs-callout--highlight");
					const pictureImg = newTag.parentElement.querySelector('.vehicle-item__image');
					const vehicleSummary = newTag.parentElement.querySelector('.vehicle-item__summary');


					const mediaQuery = window.matchMedia('(max-width: 653px)')

					function handleTabletChange(e) {
						// Check if the media query is true
						if (e.matches) {
							// Then log the following message to the console
							// console.log('Media Query Matched!');
							if (!newTag.parentElement.classList.contains("iso-preSelectedClass-filtered") && pictureImg !== null) {
								vehicleSummary.insertAdjacentElement("afterbegin", newTag);
							}
							if (newTag.parentElement.classList.contains("iso-preSelectedClass-filtered")) {
								newTag.style.display = "none";
							}
						} else {
							if (!newTag.parentElement.classList.contains("iso-preSelectedClass-filtered") && pictureImg !== null) {
								// console.log("pictureImg", pictureImg)
								pictureImg.insertAdjacentElement("afterbegin", newTag);
							}
							if (newTag.parentElement.classList.contains("iso-preSelectedClass-filtered")) {
								newTag.style.display = "none";
							}
						}
					}

					// Register event listener
					mediaQuery.addListener(handleTabletChange);

					// Initial check
					handleTabletChange(mediaQuery);
				});

			},
			addPreselect: function (vehicleItem) {
				vehicleItem.classList.add('iso-preSelectedClass');
				var vi = vehicleItem.querySelector('.vehicle-item');
				if (isoTest.onLoadpreSelected && (vi.classList.contains('is-search-by-filter') || vi.classList.contains('is-pre-selected'))) {
					vehicleItem.classList.add('iso-preSelectedClass-filtered');
				} else if (isoTest.onLoadpreSelected && (!vi.classList.contains('is-search-by-filter') || !vi.classList.contains('is-pre-selected'))) {
					vehicleItem.classList.add('iso-preselected-second');
				}

				var tag = helpers.supplant(isoTest.template, {
					'tag': isoTest.onLoadpreSelected ? isoTest.vehicleClass.shortTag : isoTest.vehicleClass.tag
				});
				vehicleItem.insertAdjacentHTML('afterbegin', tag);

				isoTest.addFeaturedOrange();
			},
			reOrder: function () {
				var o = 0;
				var featVehicle = document.querySelector('.iso-preSelectedClass .vehicle-item');
				if (featVehicle && (!featVehicle.classList.contains('is-search-by-filter') || !featVehicle.classList.contains('is-pre-selected'))) {
					for (var i = 0; i < isoTest.vehicleItems.length; i++) {
						if (!isoTest.vehicleItems[i].classList.contains('iso-preSelectedClass')) {
							isoTest.vehicleItems[i].style.order = o;

							if (i == 0 && isoTest.lastPreselectedIndex == -1 && (isoTest.vehicleItems[i].classList.contains('vehicle-list__unavailable-car') || isoTest.vehicleItems[i].firstChild.classList.contains('vehicle-not-enough-points'))) {
								o += 1;
								featVehicle.parentNode.style.order = o;
							} else if (i == 0 && isoTest.lastPreselectedIndex == -1 && !isoTest.vehicleItems[i].firstChild.classList.contains('vehicle-not-enough-points')) {
								// featVehicle.parentNode.style.order = -1;
							} else if (i == isoTest.lastPreselectedIndex) {
								o += 1;
								featVehicle.parentNode.style.order = o;
							}
							o++;
						} else {
							if (i == 0 && isoTest.vehicleItems[i].classList.contains('iso-preSelectedClass')) {
								featVehicle.parentNode.style.order = o;
								o++;
							}
						}
					}
				}
				var e = new Event('ttFeatOrder');
				window.dispatchEvent(e);
			},
			observeEl: function (selector, callback) {
				var processed = new Map();

				var processElement = function processElement(el) {
					if (processed && !processed.has(el)) {
						processed.set(el, true);
						callback(el);
					}
				};

				var lookForSelector = function lookForSelector() {
					var el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document;

					if (el.matches && el.matches(selector)) {
						if (processElement(el)) return true;
					}

					if (el.querySelectorAll) {
						var elements = el.querySelectorAll(selector);

						if (elements.length) {
							for (var i = 0; i < elements.length; i++) {
								var _el = elements[i];
								if (processElement(_el)) return true;
							}
						}
					}
				};
				lookForSelector();

				var obs = new MutationObserver(function (mutationsList) {
					mutationsList.forEach(function (record) {
						if (record && record.addedNodes && record.addedNodes.length) {
							for (var i = 0; i < record.addedNodes.length; i++) {
								var el = record.addedNodes[i].parentElement;
								if (el && lookForSelector(el)) return true;
							}
						}
					});
				});
				obs.observe(document, {
					attributes: true,
					attributeFilter: ['style', 'className'],
					childList: true,
					subtree: true
				});
			},
			elementLoaded: function (ele, callback) {
				isoTest.log('elementLoaded::  ' + ele + ' - Checking...');
				window.clearTimeout(isoTest.eleTimer);
				if (document.querySelectorAll(ele).length > 0) {
					if (typeof callback === 'function') {
						isoTest.log('elementLoaded::  ' + ele + ' - Found!');
						callback();
					}
				} else {
					isoTest.eleTimer = window.setTimeout(function () { isoTest.elementLoaded(ele, callback); }, 100);
				}
			},
			log: function (obj) {
				if (isoTest.debug === true) {
					console.log(obj);
				}
			}
		};
		var helpers = {
			getQueryParam: function (variable) {
				var query = window.location.search.substring(1);
				var vars = query.split('&');
				for (var i = 0; i < vars.length; i++) {
					var pair = vars[i].split('=');
					if (decodeURIComponent(pair[0]) == variable) {
						return decodeURIComponent(pair[1]);
					}
				}
			},
			supplant: function (str, o) {
				return str.replace(/{([^{}]*)}/g, function (a, b) {
					var p = b.split(/\./),
						c = o;
					for (var i = 0; i < p.length; i++) {
						if (c[p[i]] == null)
							return a;
						c = c[p[i]];
					}
					return typeof c === 'string' || typeof c === 'number' ? c : a;
				});
			}
		};
		isoTest.init();
	})();
</script>