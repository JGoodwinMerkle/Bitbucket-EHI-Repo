<style>
	/* to invert color on enterprise version */
	.extras-row.selected .accessible  .extras-row__description__image,
	.extras-row.selected .accessible .extras-mobile-row__description__image {
		filter: invert(100%) sepia(93%) saturate(6%) hue-rotate(215deg) brightness(150%) contrast(100%);
	}

	/* fixes p text collision w/ title */
	@media screen and (max-width: 768px) {
		.merk-individual-extra-info .extras-row__details-text .extras-row__description {
			margin-top: 1.625rem;
		}
	}
</style>
<script>
	(function () {
		'use strict';
		var isoTest = {
			account: 'EHI',
			portfolio: 'Enterprise',
			test: 'MVT-546',
			creative: 'Challenger 0',
			lang: document.URL.split('/')[3],
			selector: '.extras-section .extras-row, .extras-section .extras-row.row-extras-mobile',
			i18n: {
				'accessible': {
					'svg': 'https://assets.gcs.ehi.com/content/dam/enterprise/icons/ADA_Default.svg',
					'alt': 'Accessibility Item Icon'
				},
				'HCL': {
					'name': {
						'es': 'Control de la Mano Izquierda',
						'pt': 'Controle da Mão Esquerda',
						'fr': 'Commande à Gauche',
						'de': 'Linke Handsteuerung'
					},
					'text': {
						'en': `Request to add {name} to your vehicle, subject to equipment, vehicle and technician availability.`,
						'es': 'Solicite agregar el control manual izquierdo a su vehículo, sujeto a la disponibilidad del equipo, el vehículo y el técnico',
						'pt': 'Solicitar a adição de controle manual esquerdo ao seu veículo, sujeito à disponibilidade de equipamentos, veículos e técnicos',
						'fr': 'Demande d\'ajout d\'une commande à main gauche à votre véhicule, sous réserve de la disponibilité de l\'équipement, du véhicule et du technicien',
						'de': 'Fordern Sie an, Ihrem Fahrzeug eine linke Steuerung hinzuzufügen, abhängig von der Verfügbarkeit von Ausrüstung, Fahrzeug und Techniker'
					}
				},
				'LFA': {
					'name': {
						'es': 'Acelerador de Pie Izquierdo',
						'pt': 'Acelerador de Pé Esquerdo',
						'fr': 'Accélérateur du Pied Gauche',
						'de': 'Linker Fußbeschleuniger'
					},
					'text': {
						'en': `Request to add {name} to your vehicle, subject to equipment, vehicle and technician availability.`,
						'es': 'Solicite agregar el acelerador de pie izquierdo a su vehículo, sujeto a la disponibilidad del equipo, el vehículo y el técnico',
						'pt': 'Solicitação para adicionar acelerador de pé esquerdo ao seu veículo, sujeito à disponibilidade de equipamentos, veículos e técnicos',
						'fr': `Demande d'ajout de l'accélérateur pour pied gauche à votre véhicule, sous réserve de la disponibilité de l'équipement, du véhicule et du technicien`,
						'de': 'Fordern Sie an, Ihrem Fahrzeug ein Gaspedal für den linken Fuß hinzuzufügen, abhängig von der Verfügbarkeit von Ausrüstung, Fahrzeug und Techniker',
					}
				},
				'PDE': {
					'name': {
						'es': 'Extensores de Pedales',
						'pt': 'Extensores de Pedais',
						'fr': 'Rallonges de Pédale',
						'de': 'Pedalverlängerungen'
					},
					'text': {
						'en': `Request to add {name} to your vehicle, subject to equipment, vehicle and technician availability.`,
						'es': 'Solicite agregar extensores de pedal a su vehículo, sujeto a la disponibilidad del equipo, el vehículo y el técnico',
						'pt': 'Solicitar a adição de extensores de pedais ao seu veículo, sujeito à disponibilidade de equipamentos, veículos e técnicos',
						'fr': `Demande d'ajout de rallonges de pédale à votre véhicule, sous réserve de la disponibilité de l'équipement, du véhicule et du technicien`,
						'de': 'Fordern Sie an, Ihrem Fahrzeug Pedalverlängerungen hinzuzufügen, abhängig von der Verfügbarkeit von Ausrüstung, Fahrzeug und Techniker',
					}
				},
				'SPR': {
					'name': {
						'es': 'Perilla Giratoria',
						'pt': 'Botão Giratório',
						'fr': 'Bouton Tournant',
						'de': 'Drehknopf'
					},
					'text': {
						'en': `Request to add {name} to your vehicle, subject to equipment, vehicle and technician availability.`,
						'es': 'Solicite agregar una perilla giratoria a su vehículo, sujeto a la disponibilidad del equipo, el vehículo y el técnico',
						'pt': 'Solicitação para adicionar o botão giratório ao seu veículo, sujeito à disponibilidade do equipamento, veículo e técnico',
						'fr': `Demander l'ajout d'un bouton rotatif à votre véhicule, sous réserve de la disponibilité de l'équipement, du véhicule et du technicien`,
						'de': 'Fordern Sie an, Ihrem Fahrzeug einen Drehknopf hinzuzufügen, abhängig von der Verfügbarkeit von Ausrüstung, Fahrzeug und Techniker',
					}
				},
				'SBE': {
					'name': {
						'es': 'Extensores de Cinturón de Seguridad',
						'pt': 'Extensores de cinto de segurança',
						'fr': `Rallonges de ceinture de sécurité`,
						'de': 'Gurtverlängerungen'
					},
					'text': {
						'en': `Request to add {name} to your vehicle, subject to equipment, vehicle and technician availability.`,
						'es': 'Solicite agregar extensores de cinturones de seguridad a su vehículo, sujeto a la disponibilidad del equipo, el vehículo y el técnico',
						'pt': 'Solicitar a adição de extensores de cinto de segurança ao seu veículo, sujeito à disponibilidade de equipamentos, veículos e técnicos',
						'fr': `Demande d'ajout de rallonges de ceinture de sécurité à votre véhicule, sous réserve de la disponibilité de l'équipement, du véhicule et du technicien`,
						'de': 'Fordern Sie an, Ihrem Fahrzeug Sicherheitsgurtverlängerungen hinzuzufügen, je nach Verfügbarkeit von Ausstattung, Fahrzeug und Techniker'
					}
				},
			},
			init: function () {

				if (_satellite && typeof _satellite.setVar === 'function' && typeof _satellite.track === 'function') {
					_satellite.setVar('TargetCampaign', isoTest.test);
					_satellite.setVar('TargetCreative', isoTest.creative);
				}

				isoTest.log('Test Running...');
				isoTest.log(isoTest.account + ' - ' + isoTest.portfolio);
				isoTest.log(isoTest.test + ' - ' + isoTest.creative);


				var getReactComponent = function (node) {
					for (var key in node) {
						if (key.startsWith('__reactInternalInstance$') || key.startsWith('__reactFiber$')) {
							return node[key];
						}
					}
					return null;
				}

				var getState = function () {
					var subdivisionCode = '';
					try {
						subdivisionCode = store.getState().toJS().app.baobab.session.gbo.pickup_location.address.country_subdivision_code;
					} catch (e) {
						subdivisionCode = '';
					}

					return subdivisionCode;
				};

				var benefitText = function (initialText, name) {
					return initialText.replace('{name}', name);
				};



				var addBenefitInfo = function (extraEl, codeName, name, code) {

					// Want to make sure we're reordering any accessible item
					if (codeName === 'accessible') {
						extraEl.parentElement.insertAdjacentElement('beforeend', extraEl); //this is meant to put it at the very end of the <table>

						extraEl.querySelector('.extras-row__summary ~ tr, .extras-mobile-row__details-text').classList.add('accessible');

						// var nameEl = extraEl.querySelector('.individual-extra__name'); This class is meant for alamo
						var nameEl = extraEl.querySelector('.extras-row__summary .extras-row__first-item .paragraph-bold');
						var extraName = isoTest.i18n[code].name && isoTest.i18n[code].name[isoTest.lang];
						if (nameEl && extraName) {
							nameEl.textContent = extraName;
						}
					}

					// Ensure there's actual values related to this benefit
					if (!isoTest.i18n[codeName]) return;
					if (!isoTest.i18n[code].text[isoTest.lang]) return;

					var benefitAlt = isoTest.i18n[codeName].alt;
					var benefitSvg = isoTest.i18n[codeName].svg;
					var benefitTextValue = benefitText(isoTest.i18n[code].text[isoTest.lang], name);

					var extrasText = 	extraEl.querySelector('.extras-mobile-row__sanitized-text p, .extras-row__sanitized-text p');
					if(extrasText){
						extrasText.textContent = benefitTextValue;
					}

					var svgImage = extraEl.querySelector('.extras-row__description__image, .extras-mobile-row__description__image');
					svgImage.src = benefitSvg;

					var lastChildEl = extraEl.querySelector(".add-remove > button");
					lastChildEl.addEventListener('click', function () {
						setTimeout(function(){
							var svgImage = extraEl.querySelector('.extras-row__description__image, .extras-mobile-row__description__image');
							svgImage.src = benefitSvg;
						}, 0);
					})
				};

				// Add in the badge
				isoTest.observeEl(isoTest.selector, function (extraEl) {
					var name = getReactComponent(extraEl).return.memoizedProps.extra.name;
					var code = getReactComponent(extraEl).return.memoizedProps.extra.code;
					var state = getState();

					var stateMatch = state === 'CO';
					var codeName = (code === 'SBE' || code === 'HCL' || code === 'LFA' || code === 'PDE' || code === 'SPR') ? 'accessible' : code;

					if (stateMatch) {
						addBenefitInfo(extraEl, codeName, name, code);
					} else if (codeName === 'accessible') {
						extraEl.classList.add('hide');
					}


				});
			},
			fireTag: function (element, value) {
				var linkName = value ? value : element.innerText;
				linkName = isoTest.test ? isoTest.test + ' : ' + linkName : linkName;
				s.linkTrackVars = 'eVar20';
				s.eVar20 = linkName;
				s.tl(this, 'o', linkName);
			},
			log: function (obj) {
				if (isoTest.debug === true) {
					console.log(obj);
				}
			},
			observeEl: function (selector, callback) {
				var processed = new Map();

				var processElement = function processElement(el) {
					if (processed && !processed.has(el)) {
						processed.set(el, true);
						callback(el);
					}
				};

				var lookForSelector = function lookForSelector() {
					var el = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : document;

					if (el.matches && el.matches(selector)) {
						if (processElement(el)) return true;
					}

					if (el.querySelectorAll) {
						var elements = el.querySelectorAll(selector);

						if (elements.length) {
							for (var i = 0; i < elements.length; i++) {
								var _el = elements[i];
								if (processElement(_el)) return true;
							}
						}
					}
				};
				lookForSelector();

				var obs = new MutationObserver(function (mutationsList) {
					mutationsList.forEach(function (record) {
						if (record && record.addedNodes && record.addedNodes.length) {
							for (var i = 0; i < record.addedNodes.length; i++) {
								var el = record.addedNodes[i].parentElement;
								if (el && lookForSelector(el)) return true;
							}
						}
					});
				});
				obs.observe(document, {
					attributes: false,
					childList: true,
					subtree: true
				});
			},
		};

		isoTest.init();
	})();
</script>