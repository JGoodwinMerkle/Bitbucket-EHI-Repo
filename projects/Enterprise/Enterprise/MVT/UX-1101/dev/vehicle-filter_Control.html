<style>
.vehicle-filter__header-cta {
	position: relative;
}
.iso-tooltip {
	clear: both;
	display: block;
	z-index: 1;
}
.iso-tooltip .tooltip-info__content{
	right: -180px;
	text-align: left;
	text-transform: none;
	top: 20px;
	visibility: visible;
	width: 255px;
}
.iso-tooltip .tooltip-info__arrow-up:after {
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-bottom: 11px solid #515151;
    bottom: 100%;
    content: ' ';
	display: block;
    height: 0;
    left: auto;
    margin: 0;
    position: absolute;
    right: 60px;
    top: auto;
    width: 0;
}
.vehicle-filter__mobile-cta .iso-tooltip .tooltip-info__content{
	right: -50px;
    top: -20px;
}
.vehicle-filter__mobile-cta .iso-tooltip .tooltip-info__arrow-up:after{
    right: -15px;
    top: 20px;
    transform: rotate(90deg);
}
.iso-unavailable-msg {
	background: #f2f2f2;
	border-bottom: .125rem solid #c3c3c3;
	display: block;
	font-size: 14px;
	padding: 15px 20px;
	width: 100%;
}
@media (max-width: 67.5625em) {
	.vehicle-filter__content .iso-tooltip {
		display: none;
	}
}
</style>
<script>
(function() {
	'use strict';
	var isoTest = {
		debug : false,
		account : 'Enterprise',
		portfolio : 'Enterprise.com',
		test : 'Vehicle Path Filter',
		cookieName : 'enVehiclePathFilter',
		customMbox : 'enVehiclePathFilterClicks',
		creative : 'Control',
		filters: '.vehicle-filter__header-cta .vehicle-filter__header-link',
		template: '<span class="tooltip-info iso-tooltip">\
			<span class="tooltip-info__content active tooltip-info__arrow-up" role="tooltip">\
				<button aria-label="{close}" class="tooltip-info__close" type="button" aria-describedby="iso-tooltip"><i class="icon icon-close-white"></i></button>\
				<span class="tooltip-info__description" id="iso-tooltip">{content}</span>\
			</span>\
		</span>',
		unavailTemplate: '<span class="iso-unavailable-msg">{content}</span>',
		content: {
			en_com: {
				filter: 'We have filtered vehicle class results based on your interest in {class}. Clear filters to see all vehicle classes available.',
				unavailable: 'Sorry, {class} vehicles are currently unavailable out at this location. You can try searching for a different location where this vehicle is available, change your dates and/or times, or select from available vehicle classes below.'
			},
			en_ca: {
				filter: 'We have filtered vehicle class results based on your interest in {class}. Clear filters to see all vehicle classes available.',
				unavailable: 'Sorry, {class} vehicles are currently unavailable out at this location. You can try searching for a different location where this vehicle is available, change your dates and/or times, or select from available vehicle classes below.'
			},
			en_uk: {
				filter: 'We have filtered vehicle class results based on your interest in {class}. Clear filters to see all vehicle classes available.',
				unavailable: 'Sorry, {class} vehicles are currently unavailable out at this location. You can try searching for a different location where this vehicle is available, change your dates and/or times, or select from available vehicle classes below.'
			},
			en_ie: {
				filter: 'We have filtered vehicle class results based on your interest in {class}. Clear filters to see all vehicle classes available.',
				unavailable: 'Sorry, {class} vehicles are currently unavailable out at this location. You can try searching for a different location where this vehicle is available, change your dates and/or times, or select from available vehicle classes below.'
			},
			en_es: {
				filter: 'We have filtered vehicle class results based on your interest in {class}. Clear filters to see all vehicle classes available.',
				unavailable: 'Sorry, {class} vehicles are currently unavailable out at this location. You can try searching for a different location where this vehicle is available, change your dates and/or times, or select from available vehicle classes below.'
			},
			en_fr: {
				filter: 'We have filtered vehicle class results based on your interest in {class}. Clear filters to see all vehicle classes available.',
				unavailable: 'Sorry, {class} vehicles are currently unavailable out at this location. You can try searching for a different location where this vehicle is available, change your dates and/or times, or select from available vehicle classes below.'
			},
			en_de: {
				filter: 'We have filtered vehicle class results based on your interest in {class}. Clear filters to see all vehicle classes available.',
				unavailable: 'Sorry, {class} vehicles are currently unavailable out at this location. You can try searching for a different location where this vehicle is available, change your dates and/or times, or select from available vehicle classes below.'
			},
			es_com: {
				filter: 'Hemos filtrado los resultados de las clases de vehículos según tu interés en {class}. Limpia los filtros para ver todas las clases de vehículo disponibles.',
				unavailable: 'Lo sentimos, pero los {class} vehículos no están disponibles en esta oficina por el momento. Puedes intentar buscar una oficina diferente donde este vehículo esté disponible, cambiar las fechas u horas, o seleccionar otro entre las clases de vehículo disponibles a continuación.'
			},
			es_es: {
				filter: 'Hemos filtrado los resultados de tipo de vehículo en función de su interés en {class}. Borrar filtros',
				unavailable: 'Lo sentimos, los vehículos {class} no están disponibles en estos momentos en esta oficina. Puede intentar buscar en una oficina diferente donde este vehículo esté disponible, cambiar las fechas y/u horas o seleccionar uno de los tipos de vehículo disponibles siguientes.'
			},
			fr_fr: {
				filter: 'Nous avons filtré les résultats de catégorie de véhicule en fonction de votre intérêt pour {class}. Supprimez les filtres',
				unavailable: 'Désolé, les véhicules de type {class} sont actuellement indisponibles dans cette agence. Vous pouvez essayer d’effectuer une recherche dans une autre agence où ce véhicule est disponible, de modifier vos dates et/ou heures, ou de choisir parmi les catégories de véhicule ci-dessous.'
			},
			fr_ca: {
				filter: 'Nous avons filtré les résultats de catégories de véhicules en fonction de votre intérêt pour {class}. Effacer les filtres',
				unavailable: 'Nous sommes désolés, les véhicules de type {class} ne sont pas disponibles actuellement à cet emplacement. Vous pouvez essayer de rechercher un emplacement différent où ce véhicule est disponible, de modifier vos dates ou vos heures, ou de sélectionner l’une des catégories de véhicules disponibles ci-dessous.'
			},
			de_de: {
				filter: 'Die Ergebnisse der Fahrzeugklassen wurden nach Ihren Interessen an {class} gefiltert. Löschen Sie die Filter',
				unavailable: 'Leider sind {class} Fahrzeuge an dieser Station zurzeit nicht verfügbar. Sie können nach einer anderen Station suchen, an der dieses Fahrzeug verfügbar ist, oder die ausgewählten Daten und/oder Zeiten ändern, oder aus den unten angezeigten Fahrzeugklassen wählen.'
			}
		},
		lang: 'en_com',
		init : function() {

			isoTest.debug = Boolean(helpers.getQueryParam('debug'));
			
			if (_satellite && typeof _satellite.setVar === 'function' && typeof _satellite.track === 'function') {
				_satellite.setVar('TargetCampaign', isoTest.test);
				_satellite.setVar('TargetCreative', isoTest.creative);
				//_satellite.track('target_variables');
			}
		
			isoTest.log('Test Running...');
			isoTest.log(isoTest.account + ' - ' + isoTest.portfolio);
			isoTest.log(isoTest.test + ' - ' + isoTest.creative);

			isoTest.setLanguage();
				
			isoTest.elementLoaded(isoTest.filters, function() {	
				isoTest.log('Test Ready!');	
				if(!ReservationStateTree.get(['model','carSelect','selectedCar'])){
					isoTest.chall();
				} else {
					isoTest.unfilter();
				}
			});

			$(window).on('hashchange', function(){
				if(/cars/.test(location.hash)){
					isoTest.elementLoaded(isoTest.filters, function() {	
						if(ReservationStateTree.get(['model','carSelect','selectedCar'])){	
							isoTest.unfilter();
						} else {
							isoTest.chall();
						}
					});
				}
			});
		},
		chall : function() {
			isoTest.log('chall()');
			isoTest.vehicleClass = ReservationStateTree.get(['model', 'carSelect', 'preSelectedCarClass']);
			if(!isoTest.vehicleClass){
				return false;
			}

			isoTest.elementLoaded('.vehicle-list__item', function() {
				isoTest.labelVehicle();
				if($('.iso-preSelectedClass').length==0 || $('.iso-preSelectedClass').parents('.vehicle-list').parent().hasClass('unavailable-vehicles__wrapper')){
					isoTest.unavailable();
				} else {
					isoTest.addTooltip();
				}
			});
		},
		unavailable: function(){
			isoTest.log('unavailable()');
			if($('.iso-unavailable-msg').length == 0){
				var content = helpers.supplant(isoTest.content[isoTest.lang].unavailable, {
					'class' : isoTest.vehicleClass
				});
				var $unavail = helpers.supplant(isoTest.unavailTemplate, {
					'content' : content
				});
				$('.vehicle-select__main').prepend($unavail);
			}
		},
		labelVehicle: function(){
			isoTest.log('labelVehicle()');
			$('.vehicle-item__title').each(function(){
			    if($(this).text() == isoTest.vehicleClass){
			        $(this).parents('.vehicle-list__item').addClass('iso-preSelectedClass');
			    }
			});
		},
		unfilter: function () {
			isoTest.log('unfilter()');
			isoTest.elementLoaded('.vehicle-list__item', function() {
				$(isoTest.filters).click();
			});
		},
		addTooltip: function(){
			isoTest.log('addTooltip()');
			if($('.iso-tooltip').length == 0){
				var content = helpers.supplant(isoTest.content[isoTest.lang].filter, {
					'class' : isoTest.vehicleClass
				});
				var $tooltip = helpers.supplant(isoTest.template, {
					'content' : content,
					'close' : enterprise.i18nReservation.resflowcarselect_0065
				});

				$(isoTest.filters).parent().prepend($tooltip);
				$('.vehicle-filter__mobile-cta').prepend($tooltip);
				isoTest.bindEvents();
			}
		},
		bindEvents: function(){
			$('.iso-tooltip .tooltip-info__close').click(function(){
				$('.iso-tooltip').remove();
			});
		},
		setLanguage: function(){
			var lang = location.pathname.split('/')[1];
			var domain = location.hostname.split('.').reverse()[0];
			isoTest.lang = lang+'_'+domain;
		},
		setTargetCookie : function (test, creative) {
			if (test && creative) {
				_satellite.setCookie('tt_info', test + '|' + creative);
			}
		},
		setTrackingCookie : function(page) {
			_satellite.setCookies('tt_review', page);
		},
		trackClicks : function(element, url) {
			var url = url || null;
		      adobe.target.trackEvent({
		          'mbox': isoTest.customMbox,
		          'params': {
		              'click': element
		          },
					'success': function() {
						if (url !== null) {
							window.location.href=url;
						}
					}
		      });
		},
		elementLoaded : function (ele, callback) {
			isoTest.log('elementLoaded::  ' + ele + ' - Checking...');
			window.clearTimeout(isoTest.eleTimer);
			if (document.querySelectorAll(ele).length > 0) {
				if (typeof callback === 'function') {
					isoTest.log('elementLoaded::  ' + ele + ' - Found!');
					callback();
				}
	        } else {
	            isoTest.eleTimer = window.setTimeout(function(){isoTest.elementLoaded(ele, callback);}, 100);
	        }
		},
		dependsLoaded : function (callback) { 
			isoTest.log(isoTest.test + ' - ' + isoTest.creative + ' - dependsLoaded - Start...');
			
			window.clearTimeout(isoTest.timer);
			//Check for jQuery
			if ((window.$ && $.isReady) || (window.jQuery && jQuery.isReady)) {
				if (typeof callback === 'function') {
					isoTest.log(isoTest.test + ' - ' + isoTest.creative + ' - dependsLoaded - Ready!');
					callback();
				}
			} else {
				isoTest.timer = window.setTimeout(function() {
					isoTest.dependsLoaded(callback);
				}, 100);
			}
		},
		log : function(obj){
			if(isoTest.debug === true){
				console.log(obj);
			}
		}
		
	}

	var helpers = {
		getQueryParam: function(variable) {
	      var query = window.location.search.substring(1);
	      var vars = query.split('&');
	      for (var i = 0; i < vars.length; i++) {
	        var pair = vars[i].split('=');
	        if (decodeURIComponent(pair[0]) == variable) {
	        	return decodeURIComponent(pair[1]);
	        }
	      }
	    },
	    supplant : function(str, o) {
			return str.replace(/{([^{}]*)}/g, function(a, b) {
		        var p = b.split(/\./),
		            c = o;
		        for (var i = 0; i < p.length; i++) {
		          if (c[p[i]] == null)
		            return a;
		          c = c[p[i]];
		        }
				return typeof c === 'string' || typeof c === 'number' ? c : a;
			});
		}
	}

	isoTest.dependsLoaded(function(){ 
		isoTest.init();
	});
})();
</script>
